<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0,minimal-ui" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
  	<link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
 	<link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
 	<!-- <link rel="stylesheet" href="https://at.alicdn.com/t/font_527495_v25vpfqtkjegsyvi.css"> -->
	<script src="__PUBLIC__/Home/js/jquery-1.10.1.js"></script>
  	<script src="__PUBLIC__/Home/js/public.js"></script>

  	<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/font-awesome.css">
    <link rel="stylesheet" href="__PUBLIC__/Home/css/style.css">
	<title>商城首页</title>
	<style>
		body, h1, h2, h3, h4, h5, h6, hr, p, blockquote, dl, dt, dd, ul, ol, li, pre, form, fieldset, legend, button, input, textarea, th, td { margin:0; padding:0; } 

		* {
			box-sizing: border-box;
		}
		body {
			/*width: 100vw;*/
			height: 100vh;
			font-size: .7rem;
			overflow-x: hidden;
			background: #fff;
		}
		#header {
			width: 100%;
			height: 8vh;
			position: fixed;
			display: -webkit-box;
			display: -ms-flexbox;
			display: flex;
			-webkit-box-pack: start;
			    -ms-flex-pack: start;
			        justify-content: flex-start;
			-webkit-box-align: center;
			    -ms-flex-align: center;
			        align-items: center;
			background: #fff;
			z-index: 999;
			overflow-x: scroll;
			overflow-y: hidden;
			box-sizing: content-box;
    		border-bottom: 1px solid #e6eaea;
		}
		#header>span {
			flex: 1 0 25%;
			width: 30vw;
			/*min-width: 60px;*/
			height: 8vh;
    		line-height: 9vh;
    		position: relative;
		    display: inline-block;
		    margin: 0 10px;
		    text-align: center;
		    font-size: 0.72rem;
		    color: #5A5A5A;
		    font-weight: 400!important;
		}
		#header>span:nth-child(1){
			color: #373737;
		}
	
		/*顶部标题下面的线*/
		/*标题切换 改这里left,20%,40%,60%,80%*/
		#line {
			width: 10vw;
			height: 1vh;
			position: absolute;
			top: 0;
			left: 3vw;
			margin-bottom: -1vh;
			transition: left .3s linear;
    		border-radius: 10px;
    		background: #2eb6aa;
		}
		
		#content {
			width: 500vw;
			position: relative;
			padding: 1vh 0;
		}
		/*商品块*/
		.goodsBlock {
			width: 100vw;
			position: absolute;
			padding: 1vh 0;
			top: 0;
			background: #fff;
			transition: left .4s ease-out;
		}

		.goods{
			width: 100%;
		}
		
		/*搜索栏 */
		.shopTop{
			width: 100%;
   			margin-top: 2rem;
   			margin-bottom: 1rem;
    		position: relative;
    		top:1.0vh;
    		z-index: 99;
		}
		.search{
    		width: 90%;
			height: 1.6rem;
			line-height: 1.4rem;
    		margin: 2.5rem auto -0.2rem;
    		border-radius: 0.266667rem;
    		position: relative;
		}
		.search>label>i {    
			height: 100%;
    		display: inline-block;
   			font-size: 0.9rem;
       }
		.search>i {
		   display: inline-block;
		    width: 2%;
		    position: absolute;
		    top: 0.1rem;
		    color: #464646;
		    right: 1.2rem;
		    font-size: 1.25rem;
		}
		/*购物车*/
		.cartnum {
			width: 1.6rem;
			height: 1.6rem;
		    position: absolute;
		    right: 0;
		    top: 0;
			display: flex;
			align-items: flex-start;
			justify-content: flex-end;
		}
		.cartnum>span {
			width: 50%;
    		height: 50%;
		    display: inline-block;
		    border-radius: 50%;
		    background: #F00;
		    font-size: 0.62rem;
		    font-weight: 600;
		    text-align: center;
		    line-height: 0.8rem;
		    color: #FFF;
        }

		.search>label {
			width: 88%;
		    display: inline-block;
		    border: 1px solid #ccc;
    		border-radius: 0.266667rem;
		}
		.search>label>input{
			display: inline-block;
			margin-left: 0.2rem;
			width: 90%;
			height: 1.4rem;
			border:none;
			font-size: 0.7rem;
		}
		.search>label>a{
			font-size: 0.9rem;
		}
		.search>a{
			display: inline-block;
			width: 10%;
			float: right;
			color:#838383;
			position: absolute;
			top:0;
			color: #464646;
			right: 0rem;
			font-size: 1.25rem;
		}
		.search>a>span{
			position: absolute;
		    display: inline-block;
		    width: 0.8rem;
		    height: 0.8rem;
		    border-radius: 1rem;
		    background: #F00;
		    right: 0rem;
		    top: 0rem;
		    font-size: 0.53rem;
		    font-weight: 600;
		    text-align: center;
		    line-height: 0.8rem;
		    color: #FFF;
		}
		#searchPanel {
			position: absolute;
			width: 104%;
			display: none;
			padding: 1% 2%;
			left: 50%;
			transform: translateX(-50%);
			border-radius: 4px;
			background: #fff;
			box-shadow: 0 1px 8px rgba(0,0,0,.3);
			z-index: 999;
		}
		#searchPanel>a {
			margin: 4px 0;
		}
		/*<!-- 轮播图 -->*/
		#slider-wrap{
			width: 90vw;
			height: 180px;
			position:relative;
			background: #fff;
		}
		
		#slider>li>a{
			display: block;
			width: 100%;
		}
		#slider>li>a>img{
			width: 90vw;
			height: 180px;
		}

		/*所有商品*/
		.goodstitle>h3{
			text-align: center;
		    font-weight: 400;
		    margin-bottom: 0.5rem;
		    font-size: 0.73rem;
		    margin-top: 0.5rem;
		    color: #373737;
		}
		.goodstitle>h3>span{
			color:#ff2e2e;
		}
		.allgoods{
			width: 100%;
			height: 12rem;
			margin:0 auto;
		}
		.allgoods>ul>li{
		   	float: left;
    		display: block;
    		position: relative;
    		width: 46%;
    		height: 8.5rem;
    		padding: 5% 0% 6% 7%;
    		box-sizing: border-box;
		}
		.allgoods>ul>li>a{
			height: 7rem;
			width: 5rem;
			display: block;
			position: relative;
			border: none!important;
		}
		.allgoods>ul>li>a>p{
    		/*width: 130%;
			display: block;
			font-size: 0.67rem;
    		line-height: 1rem;
    		overflow: hidden;
    		text-overflow: ellipsis;
    		white-space: nowrap;*/
		    display: block;
		    font-size: 0.67rem;
		    line-height: 1.7rem;
		    width: 130%;
		    color: #373737;
		}
		.allgoods>ul>li>i{
			position: absolute;
			width: 2rem;
		    height: 1.2rem;
		    display: inline-block;
    		right: 0;
		    margin-top: -0.74rem;
		    text-align: right;
			font-size: 1rem;
		    color: #ff3232;    
		    z-index: 999;
		}
		.allgoods>ul>li>a>b{
			display: inline-block;
			/*margin-top: 6%;*/
			font-size: 0.74rem;
			color: #ff3232;
			font-weight: 400;
		}
		.allgoods>ul>li>a>img{
			width: 130%;
			height: 66%;
			display: inline-block;
			border: 1px solid #ddd;
    		border-radius: 6px;
		}
		.numShow {
			animation: numshow .5s ease;
		}
		@keyframes numshow {
			0%, 33% {
				transform: scale(.8);
			}
			34%, 67% {
				transform: scale(1.2);
			}
			68%, 100% {
				transform: scale(1);
			}
		}
		
	</style>
</head>
<body>

	<input type="hidden" value='{{$cate}}' id="_cate">
	<input type='hidden' value='{{$goods}}' id='_goods'>
	<input type="hidden" value='{{$cartInfo}}' id="cartInfo">
	<header id="header">
		<!-- <span class="tab" index='0'>净水器</span>
		<span class="tab" index='1'>净化器</span>
		<span class="tab" index='2'>热水器</span>
		<span class="tab" index='3'>生活用品</span>
		<span class="tab" index='4'>瓦胆</span>
		<div id="line"></div> -->
	</header>
	<div class="shopTop clearfix">
		<div class="search clearfix">
			<label for="search-all">
				<input type="text" placeholder="请输入您想买的东西" ><i class="searchBtn iconfont icon-msnui-find-bold"></i>
			</label><i class="iconfont  icon-gouwuche"></i><span class="cartnum"><span></span></span>
			<div id="searchPanel">
				<!-- <p>见识到了官方十多个</p>
				<p>见识到了官方十多个</p>
				<p>见识到了官方十多个</p> -->
			</div>
		</div>

		<!-- 轮播图 -->
		<div id="wrapper">
	
			<div id="slider-wrap">
			  <ul id="slider">
			    <li><a class="pic" goods_gid="{{$goodsList[0]['gid']}}" href="{{:U('Shop/shoppingdetail')}}"><img src="/Uploads/{{$goodsList[0]['path']}}" /></a></li>
			    <li><a class="pic" goods_gid="{{$goodsList[1]['gid']}}" href="{{:U('Shop/shoppingdetail')}}"><img src="/Uploads/{{$goodsList[1]['path']}}" /></a></li>
			    <li><a class="pic" goods_gid="{{$goodsList[2]['gid']}}" href="{{:U('Shop/shoppingdetail')}}"><img src="/Uploads/{{$goodsList[2]['path']}}" /></a></li>
			    <li><a class="pic" goods_gid="{{$goodsList[3]['gid']}}" href="{{:U('Shop/shoppingdetail')}}"><img src="/Uploads/{{$goodsList[3]['path']}}" /></a></li>
			    <li><a class="pic" goods_gid="{{$goodsList[4]['gid']}}" href="{{:U('Shop/shoppingdetail')}}"><img src="/Uploads/{{$goodsList[4]['path']}}" /></a></li>		 
			  </ul>
			  
			   <!--controls-->
			  <div class="btns" id="next"><i class="fa fa-arrow-right"></i></div>
			  <div class="btns" id="previous"><i class="fa fa-arrow-left"></i></div>
			  <div id="counter"></div>
			  
			  <div id="pagination-wrap">
				<ul>
				</ul>
			  </div>
			  <!--controls-->  
					 
			</div>
		</div>		
	</div>
	<div id="content">
		
		<!-- 净水器 -->
		<!-- <div id="waterPurifier">
			 <div class="goods" > -->
				<!-- /*所有商品*/ -->
				<!-- <div class="goodstitle">
					<h3><span>——</span> 特惠专区 <span>——</span></h3>
				</div>
				<div class="allgoods">
					<ul>
						<li>
							<a href="#">
								<img src="__PUBLIC__/Home/images/goods1.png" alt="">
								<p>Jagabee 麦片套装</p>
								<b>¥ 89.00</b><i class="iconfont icon-jiarugouwuche "></i><span class="iconfont "></span>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div> -->
	</div>
	
	<script src="__PUBLIC__/Admin/js/plugins/layer/layer.min.js"></script>
	<script>
		$(function(){
			//首页显示购物车数量
			// console.log($("#cartInfo").val())
			if(JSON.parse($("#cartInfo").val())){
				$(".cartnum>span").text(JSON.parse($("#cartInfo").val()));
			}else {
				// 如果购物车没有商品
				$(".cartnum>span").text(0);
			}
			//存放分栏的商品信息
			var CategoryHTML = '', categoryArr = [];
			var goodblockHTML = '';		//分栏商品模板
			var _htmlArr = [];	//存放对应分类数据的数组
			var searchArr = [];		//存放搜索用数据
			// 获取商品分类
			var _cate;
			if($("#_cate").val()){
				//有数据
				_cate = JSON.parse($("#_cate").val());
				// console.log(_cate);
				// 遍历分类
				for(var i=0;i<_cate.length; i++){
					CategoryHTML += '<span class="tab" index='+i+'>'+ _cate[i].name +'</span>';
					categoryArr.push(_cate[i].name);
				}

				/*
					遍历模板
				 */
				for(var i=0; i<_cate.length; i++){
					goodblockHTML += 
						'<div class="goodsBlock" index='+i+'>'+
						  '<div class="goods" >'+
							<!-- /*所有商品*/ -->
							'<div class="goodstitle">'+
								'<h3><span>——</span> 特惠专区 <span>——</span></h3>'+
							'</div>'+
							'<div class="allgoods">'+
								'<ul></ul>'+
								'</div>'+
							'</div>'+
						'</div>';
				}

				// 横线
				var _lineHTML = '<div id="line"></div>';
				$("#header").html(CategoryHTML+ _lineHTML);
				$("#content").append(goodblockHTML);

			}else{
				$("#header").html('暂无分类');
				console.log('暂无分类');
			}
			/*
				遍历商品
			 */
			var _goods;
			if($("#_goods").val() != 'null'){
				//有数据
				_goods = JSON.parse($("#_goods").val());
				// console.log(_goods);
				if(_cate){
					for(var i=0;i<_cate.length; i++){
						_htmlArr[[i]] = '';		//使用前先初始化
						searchArr[[i]] = '';		//使用前先初始化
						for(var j=0; j<_goods.length; j++){
							if(_goods[j].cid == _cate[i].id){	//对应分类下有商品
								// console.log(_goods[j].cid, _cate[i].id);
								searchArr[i] += '<a href="{{:U('Shop/shoppingdetail')}}" goods_gid="'+_goods[j].gid+'">'+
										'<p>'+ _goods[j].name +'</p>'+
									'</a>';

								_htmlArr[i] += 
									'<li>'+
										'<a class="pic" goods_gid="'+_goods[j].gid+'" href="javasctipt:;">'+
											'<img src="/Uploads/'+_goods[j].path+'" alt="正在加载中...">'+
											'<p class="name">'+ _goods[j].name +'</p>'+
											'<b class="price">¥'+ _goods[j].price +'</b><span class="iconfont "></span>'+
										'</a>'+
										'<i class="iconfont icon-jiarugouwuche"></i>'
									'</li>';
							}else{
								_htmlArr[i] += '';
							}
						}
					}

					//遍历轮播图
					// var lubolength = _goods.length > 4 ? 4 : _cate.length;
					// console.dir(_goods.length)
					// var lunboHTML = '';
					// for(var i=0;i<lubolength; i++){
					// 	// lunboHTML += '<li><a href="'+{{:U("Shop/shoppingdetail")}}+'" gid="'+lubolength.gid+'"><img src="/Uploads/'+_goods[j].path+'" /></a></li>';
					// 	lunboHTML += '<li><a href="{{:U("Shop/shoppingdetail")}}" goods_gid="'+_goods[i].gid+'"><img src=""/Uploads/'+_goods[i].path+'" /></a></li>';
					// }
					// $(".pic>ul").html(lunboHTML);
					// console.log(lunboHTML)

				}
			}else{
				//无数据
				$(".allgoods>ul").html('<h3 style="text-align:center;padding:5% 0;">暂无内容，敬请期待！<div></div></h3>');
				console.log('暂无商品');
			}
			
			// 遍历偏移量
			for(var i=0; i<categoryArr.length; i++){
				$("#content").find('.goodsBlock').eq(i).css({left: i*100 +'vw'});
				// console.log($("#content").find('.goodsBlock').attr("index"))
			}
			/*
				如果第一页有内容则加载第一页
			 */
			console.log(_htmlArr)
			if(_htmlArr[0]){
				$(".allgoods>ul").eq(0).html(_htmlArr[0]);
				// console.log($("#content>div").eq(0).attr("index"))
			}else{
				$(".allgoods>ul").eq(0).html('<h3 style="text-align:center;padding:5% 0;">暂无内容，敬请期待！<div></div></h3>');
			}

			/*
				点击的时候记录当前点击的商品gid，传给商品详情页面
			 */
			$(".goodsBlock").on('click','.pic',function(){
				// console.log($(this).attr("goods_gid"))
				sessionStorage.setItem("goods_gid", $(this).attr("goods_gid"));
				// 将当前商品id拼接到地址URL
				$(this).attr("href", "{{:U('Shop/shoppingdetail')}}?gid=" + $(this).attr("goods_gid"));
				// console.log($(this).attr('href'));
				// 跳转到商品详情页面
				location.href = $(this).attr('href');
			})

			$("#slider").on('click','.pic',function(){
				// console.log($(this).attr("goods_gid"))
				sessionStorage.setItem("goods_gid", $(this).attr("goods_gid"))
			})

			/*
				点击顶部导航栏，切换订单状态
			 */ 
			$("#header").on("click",'.tab',function(){
				var _this = $(this);
				if(_htmlArr[$(this).attr("index")]){	//如果当前分类下有商品
					$(".allgoods>ul").eq($(this).attr("index")).html(_htmlArr[$(this).attr("index")]);
					// console.log($("#content>div").eq($(this).attr("index")).attr("index"))
				}else{
					$(".allgoods>ul").eq($(this).attr("index")).html('<h3 style="text-align: center;padding:5% 0;">暂无内容，敬请期待！<div></div></h3>')
				}
				$('#header>span').css('color','#5A5A5A').css('font-weight','400');
				$(this).css('color','#373737').css('font-weight','400');
				//切换内容
				$("#content")
				.css({transition: '.5s ease',transform: 'translateX(-'+ $(this).attr("index") +'00vw)'});

				$("#line").css({left: $(this)[0].offsetLeft+$(this)[0].clientWidth/2-$("#line")[0].clientWidth/2 + 'px'});
				// $(this).parents('#header')[0].scrollLeft = $(this)[0].offsetLeft;
				// for(var i=0; i<$(this)[0].offsetLeft; i++){
				var len = 10;
				//顶部分类移动
				var int = setInterval(function(){
					_this.parents('#header')[0]
						.scrollLeft = _this[0].offsetLeft/2;
					
					len += 6;
						console.log(len, _this[0].offsetLeft)
					if(len >= _this[0].offsetLeft-1){
						len = 0;
						clearInterval(int);
					}
				},1)
				// }
				// console.log($(this)[0].offsetLeft)
			});
			// console.log($('.tab')[0].offsetLeft+$('.tab')[0].clientWidth-$("#line")[0].clientWidth/2)
			$("#line").css({left: $('.tab')[0].offsetLeft+$('.tab')[0].clientWidth/2-$("#line")[0].clientWidth/2 + 'px'});
			$('#header>span').eq(0).css('color','#373737').css('font-weight','600');

			/*
				点击商品旁边的购物车图标
			 */
			$(".allgoods").on("click",".icon-jiarugouwuche",function(){
				var _this = $(this);
				// 获取商品id
				var gid = $(this).siblings(".pic").attr("goods_gid");
				console.log(gid);
				//添加点击效果
				$(this).addClass("numShow");
				$(".cartnum>span").addClass("numShow");
				setTimeout(function(){
					//移除点击效果
					_this.removeClass("numShow");
					$(".cartnum>span").removeClass("numShow");
				},500)
				//告诉后台添加到数据库
				$.ajax({
					url: '{{:U("ShoppingCart/shopAdd")}}',
					type: 'post',
					data: {'gid': gid,'num': 1},
					success: function(res){
						console.log('成功！ ',res);
						//更新购物车商品数量
	       				$(".cartnum>span").text(res);
	       				parent.layer.msg('已加入购物车！');
					},
					error: function(res){
						console.log('失败！ ',res);
	       				parent.layer.msg('加入购物车失败，请稍后再试！');
					}
				})
			})
			//点击搜索框旁的购物车图标跳转到购物车
			$('.cartnum').click(function(){
				location.href = '{{:U("ShoppingCart/index")}}';
			})

			/*
				监听input内容实时搜索
			 */
			$(".search input").on('keyup', function(){
				_search($(this).val());
			})
			/*
				点击搜索
			 */
			$(".searchBtn").click(function(){
				_search($(this).siblings('input').val());

			})
			// 点击搜索内容存储 商品id 到本地存储 给 商品详情页面用
			$("#searchPanel").on('click', 'a', function(){
				sessionStorage.setItem("goods_gid", $(this).attr("goods_gid"))
			})
			//搜索函数
			function _search(word){
				// console.log(word);
				if(word){
					// console.log(searchArr);
					//遍历适配的数据
					for(var i=0; i<searchArr.length; i++){
						if(searchArr[i].indexOf(word) > -1){
							$("#searchPanel").html(searchArr[i]);
						}
					}
					$("#searchPanel").fadeIn('fast');
				}else{
					console.log('没有输入内容!')
				}
			}
		})

	</script>
<!-- 	<script src="__PUBLIC__/Home/js/jquery.min.js"></script> -->
	<script type="text/javascript" src="__PUBLIC__/Home/js/slide.js"></script>

</body>
</html>