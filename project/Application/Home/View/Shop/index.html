<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0,minimal-ui" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />
  	<link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
  	<link rel="stylesheet" href="__PUBLIC__/Home/css/mF_fancy.css">
 	<link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
	<script src="__PUBLIC__/Home/js/jquery-1.10.1.js"></script>
	<script src="__PUBLIC__/Home/js/myfocus-2.0.1.min.js"></script>
  	<script src="__PUBLIC__/Home/js/public.js"></script>
	<title>商城首页</title>
	<style>
		body, h1, h2, h3, h4, h5, h6, hr, p, blockquote, dl, dt, dd, ul, ol, li, pre, form, fieldset, legend, button, input, textarea, th, td { margin:0; padding:0; } 

		* {
			box-sizing: border-box;
		}
		body {
			/*width: 100vw;*/
			height: 100vh;
			font-size: .7rem;
			overflow-x: hidden;
		}
		#header {
			width: 100%;
			height: 8vh;
			position: fixed;
			display: -webkit-box;
			display: -ms-flexbox;
			display: flex;
			-webkit-box-pack: start;
			    -ms-flex-pack: start;
			        justify-content: flex-start;
			-webkit-box-align: center;
			    -ms-flex-align: center;
			        align-items: center;
			background: #fff;
			z-index: 999;
			overflow-x: scroll;
			overflow-y: hidden;
			box-sizing: content-box;
		}
		#header>span {
			flex: 1 0 25%;
			width: 30vw;
			/*min-width: 60px;*/
			height: 8vh;
    		line-height: 8vh;
    		position: relative;
		    display: inline-block;
		    margin: 0 10px;
		    text-align: center;
		    font-size: 0.72rem;
		    color: #5A5A5A;
		}
		#header>span:nth-child(1){
			color:#373737;
		}
	
		/*顶部标题下面的线*/
		/*标题切换 改这里left,20%,40%,60%,80%*/
		#line {
			width: 10vw;
			height: 1vh;
			position: absolute;
			top: 0;
			left: 3vw;
			margin-bottom: -1vh;
			transition: left .2s ease-in;
    		border-radius: 10px;
    		background: #60ACF0;
		}
		
		#content {
			width: 500vw;
			position: relative;
			padding: 1vh 0;
		}
		/*商品块*/
		.goodsBlock {
			width: 100vw;
			position: absolute;
			padding: 1vh 0;
			top: 0;
			background: #fff;
			transition: left .4s ease-out;
		}

		.goods{
			width: 100%;
		}
		
		/*搜索栏 */
		.shopTop{
			width: 100%;
   			margin-top: 2rem;
   			margin-bottom: 1rem;
    		position: relative;
    		top:1.0vh;
    		z-index: 99;
		}
		.search{
    		width: 90%;
			height: 1.6rem;
			line-height: 1.4rem;
    		margin: 0rem auto;
    		border-radius: 0.266667rem;
    		position: relative;
		}
		.search>label {
			width: 88%;
		    display: inline-block;
		    border: 1px solid #ccc;
    		border-radius: 0.266667rem;
		}
		.search>label>input{
			display: inline-block;
			margin-left: 0.2rem;
			width: 90%;
			height: 1.4rem;
			border:none;
			font-size: 0.7rem;
		}
		.search>label>a{
			font-size: 0.9rem;
		}
		.search>a{
			display: inline-block;
			width: 10%;
			float: right;
			color:#838383;
			position: absolute;
			top:0;
			color: #464646;
			right: 0rem;
			font-size: 1.25rem;
		}
		.search>a>span{
			position: absolute;
		    display: inline-block;
		    width: 0.8rem;
		    height: 0.8rem;
		    border-radius: 1rem;
		    background: #F00;
		    right: 0rem;
		    top: 0rem;
		    font-size: 0.53rem;
		    font-weight: 600;
		    text-align: center;
		    line-height: 0.8rem;
		    color: #FFF;
		}
		/*<!-- 轮播图 -->*/
		#myFocus{
			border:1px solid #F6F6F6;
			width:90%;
			height:6rem;
			margin:0.8rem 5%;
			border-radius: 0.3rem;
		}
		.mF_fancy .prev,.mF_fancy .next{
			top:25%!important;
		}
		.pic>ul>li>a>img{
			/*width: 100%;*/
		}
		.mF_fancy_myFocus{
			margin-top: 0.066667rem;
		}
		/*所有商品*/
		.goodstitle>h3{
			text-align: center;
    	    font-weight: 600;
    	    margin-bottom: 0.5rem;
    	    font-size: 0.73rem;
    	    margin-top: 0.5rem;
    	    color:#373737;
		}
		.goodstitle>h3>span{
			color:#ff2e2e;
		}
		.allgoods{
			width: 100%;
			height: 12rem;
			margin:0 auto;
		}
		.allgoods>ul>li{
		   	float: left;
		    display: block;
		    position: relative;
		    width: 50%;
		    height: 8.5rem;
		    padding: 5% 5%;
		    box-sizing: border-box;
		}
		.allgoods>ul>li>a{
			height: 7rem;
			width: 5rem;
			display: block;
			position: relative;
		}
		.allgoods>ul>li>a>p{
    		width: 130%;
			display: block;
			font-size: 0.67rem;
    		line-height: 1rem;
    		overflow: hidden;
    		text-overflow: ellipsis;
    		white-space: nowrap;
		}
		.allgoods>ul>li>i{
			font-size: 1.2rem;
			color: #ff3232;
		    position: absolute;
		    right: 8%;
		    bottom: 8%;
		    z-index: 999;
		}
		.allgoods>ul>li>a>b{
			display: inline-block;
			margin-top: 6%;
			font-size: 0.68rem;
			color: #ff3232;
		}
		.allgoods>ul>li>a>img{
			width: 130%;
			height: 66%;
			display: inline-block;
			border: 1px solid #ddd;
			border-radius: 4px;
		}
		
	</style>
</head>
<body>
	<input type="hidden" value='{{$cate}}' id="_cate">
	<input type='hidden' value='{{$goods}}' id='_goods'>
	<input type="hidden" value='{{$cartInfo}}' id="cartInfo">
	<header id="header">
		<!-- <span class="tab" index='0'>净水器</span>
		<span class="tab" index='1'>净化器</span>
		<span class="tab" index='2'>热水器</span>
		<span class="tab" index='3'>生活用品</span>
		<span class="tab" index='4'>瓦胆</span>
		<div id="line"></div> -->
	</header>
	<div class="shopTop clearfix">
		<div class="search clearfix">
			<label for="search-all" >
				<input type="text" placeholder="请输入您想买的东西" ><i class="iconfont icon-msnui-find-bold"></i>
			</label>
			<a href="{{:U('ShoppingCart/index')}}" class="iconfont  icon-gouwuche"><span>1</span></a>
		</div>
		<!-- 轮播图 -->
		<div id="myFocus"><!--焦点图盒子-->
			 <div class="loading"><img src="__PUBLIC__/Home/images/loading.gif" alt="请稍候..." /></div><!--载入画面(可删除)-->
			  <div class="pic"><!--图片列表-->
			  	<ul>
			        <li><a href="#1"><img src="__PUBLIC__/Home/images/1b.png" thumb="" alt="" text="" /></a></li>
			        <li><a href="#2"><img src="__PUBLIC__/Home/images/2b.png"  /></a></li>
			        <li><a href="#3"><img src="__PUBLIC__/Home/images/3b.png" /></a></li>
			        <li><a href="#4"><img src="__PUBLIC__/Home/images/4b.png" /></a></li>
			        <!-- <li><a href="#5"><img src="__PUBLIC__/Home/images/5a.jpg" /></a></li> -->
			  	</ul>
			  </div>
		</div>
	</div>
	
	<div id="content">
		
		<!-- 净水器 -->
		<!-- <div id="waterPurifier">
			 <div class="goods" > -->
				<!-- /*所有商品*/ -->
				<!-- <div class="goodstitle">
					<h3><span>——</span> 特惠专区 <span>——</span></h3>
				</div>
				<div class="allgoods">
					<ul>
						<li>
							<a href="#">
								<img src="__PUBLIC__/Home/images/goods1.png" alt="">
								<p>Jagabee 麦片套装</p>
								<b>¥ 89.00</b><i class="iconfont icon-gouwuchetianjia "></i><span class="iconfont "></span>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div> -->
	</div>
	
	<script src="__PUBLIC__/Admin/js/plugins/layer/layer.min.js"></script>
	<script>
		$(function(){
			//首页显示购物车数量
			// console.log($("#cartInfo").val())
			if(JSON.parse($("#cartInfo").val())){
				$(".icon-gouwuche>span").text(JSON.parse($("#cartInfo").val()));
			}else {
				// 如果购物车没有商品
				$(".icon-gouwuche>span").hide();
			}
			//存放分栏的商品信息
			var CategoryHTML = '', categoryArr = [];
			var goodblockHTML = '';		//分栏商品模板
			var _htmlArr = [];	//存放对应分类数据的数组
			// 获取商品分类
			var _cate;
			if($("#_cate").val()){
				//有数据
				_cate = JSON.parse($("#_cate").val());
				// console.log(_cate);
				// 遍历分类
				for(var i=0;i<_cate.length; i++){
					CategoryHTML += '<span class="tab" index='+i+'>'+ _cate[i].name +'</span>';
					categoryArr.push(_cate[i].name);
				}
				/*
					遍历模板
				 */
				for(var i=0; i<_cate.length; i++){
					goodblockHTML += 
						'<div class="goodsBlock" index='+i+'>'+
						  '<div class="goods" >'+
							<!-- /*所有商品*/ -->
							'<div class="goodstitle">'+
								'<h3><span>——</span> 特惠专区 <span>——</span></h3>'+
							'</div>'+
							'<div class="allgoods">'+
								'<ul></ul>'+
								'</div>'+
							'</div>'+
						'</div>';
				}

				// 横线
				var _lineHTML = '<div id="line"></div>';
				$("#header").html(CategoryHTML+ _lineHTML);
				$("#content").append(goodblockHTML);

			}else{
				$("#header").html('暂无分类');
				console.log('暂无分类');
			}
			/*
				遍历商品
			 */
			var _goods;
			if($("#_goods").val() != 'null'){
				//有数据
				_goods = JSON.parse($("#_goods").val());
				console.log(_goods);
				if(_cate){
					for(var i=0;i<_cate.length; i++){
						_htmlArr[[i]] = '';		//使用前先初始化
						for(var j=0; j<_goods.length; j++){
							if(_goods[j].cid == _cate[i].id){	//对应分类下有商品
								// console.log(_goods[j].cid, _cate[i].id);
								_htmlArr[i] += 
									'<li>'+
										'<a class="pic" goods_gid="'+_goods[j].gid+'" href="{{:U('Shop/shoppingdetail')}}">'+
											'<img src="/Uploads/'+_goods[j].path+'" alt="正在加载中...">'+
											'<p class="name">'+ _goods[j].name +'</p>'+
											'<b class="price">¥'+ _goods[j].price +'</b><span class="iconfont "></span>'+
										'</a>'+
										'<i class="iconfont icon-gouwuchetianjia "></i>'
									'</li>';
							}else{
								_htmlArr[i] += '';
							}
						}
					}
					console.log(_htmlArr)
				}
			}else{
				//无数据
				$(".allgoods>ul").html('<h3 style="text-align:center;padding:5% 0;">暂无内容，敬请期待！<div></div></h3>');
				console.log('暂无商品');
			}
			
			// 遍历偏移量
			for(var i=0; i<categoryArr.length; i++){
				$("#content").find('.goodsBlock').eq(i).css({left: i*100 +'vw'});
				// console.log($("#content").find('.goodsBlock').attr("index"))
			}
			/*
				如果第一页有内容则加载第一页
			 */
			if(_htmlArr[0]){
				$(".allgoods>ul").eq(0).html(_htmlArr[0]);
				// console.log($("#content>div").eq(0).attr("index"))
			}else{
				$(".allgoods>ul").eq(0).html('<h3 style="text-align:center;padding:5% 0;">暂无内容，敬请期待！<div></div></h3>');
			}

			/*
				点击的时候记录当前点击的商品gid，传给商品详情页面
			 */
			$(".goodsBlock").on('click','.pic',function(){
				// console.log($(this).attr("goods_gid"))
				sessionStorage.setItem("goods_gid", $(this).attr("goods_gid"))
			})

			/*
				点击顶部导航栏，切换订单状态
			 */ 
			$("#header").on("click",'.tab',function(){
				
				if(_htmlArr[$(this).attr("index")]){
					$(".allgoods>ul").eq($(this).attr("index")).html(_htmlArr[$(this).attr("index")]);
					// console.log($("#content>div").eq($(this).attr("index")).attr("index"))
				}else{
					$(".allgoods>ul").eq($(this).attr("index")).html('<h3 style="text-align: center;padding:5% 0;">暂无内容，敬请期待！<div></div></h3>')
				}
				// if($('#content>div').length != 0){
					 $('#header>span').css('color','#5A5A5A').css('font-weight','400');
					$(this).css('color','#373737').css('font-weight','600');
					// $("#content")
					// .css({height: dingdanArr[$(this).attr("index")]
					// 	.height, 
					// 	overflowY: $(dingdanArr[$(this).attr("index")])[0].offsetHeight > $("#content")[0].offsetHeight 
					// 	? 'visible'
					// 	: 'hidden'
					// });
					
					// console.log( $(this).attr("index") );
					// console.log( $("#content")[0].offsetHeight );

					// }
					$("#content")
					.animate({left: '-'+ $(this).attr("index") +'00vw'});

					$("#line").css({left: $(this)[0].offsetLeft+$(this)[0].clientWidth/2-$("#line")[0].clientWidth/2 + 'px'});

					// console.log($(this)[0].offsetLeft)
					console.log($(this))
			});
			// console.log($('.tab')[0].offsetLeft+$('.tab')[0].clientWidth-$("#line")[0].clientWidth/2)
			$("#line").css({left: $('.tab')[0].offsetLeft+$('.tab')[0].clientWidth/2-$("#line")[0].clientWidth/2 + 'px'});
			$('#header>span').eq(0).css('color','#373737').css('font-weight','600');

			/*
				点击商品旁边的购物车图标
			 */
			$(".allgoods").on("click",".icon-gouwuchetianjia",function(){
				// 获取商品id
				var gid = $(this).siblings(".pic").attr("goods_gid");
				console.log(gid);
				$.ajax({
					url: '{{:U("ShoppingCart/shopAdd")}}',
					type: 'post',
					data: {'gid': gid,'num': 1},
					success: function(res){
						console.log('成功！ ',res);
	       				parent.layer.msg('已加入购物车！');
					},
					error: function(res){
						console.log('失败！ ',res);
	       				parent.layer.msg('加入购物车失败，请稍后再试！');
					}
				})
			})
		})

		// 轮播
		myFocus.set({
			id:'myFocus',//ID
			pattern:'mF_fancy',//风格
			time:3,
			height:172,
			// width:600,
		});
		$('.pic>ul>li>a>img').css('width','94vw');
		$("#line").width = $(".tab").width;

	</script>
</body>
</html>