<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name='viewport' content='width=device-width,initial-scale=1.0,user-scalable=no'>
	<title>服务记录</title>
	<link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfontHome.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/service/service_record.css">
	<script src='__PUBLIC__/Home/js/vue.min.js'></script>
	<script src='__PUBLIC__/Home/js/public.js'></script>
</head>
<body>
	<div id='service_record'>
		<div class='search'>
			<span>
				<i class='iconfont icon-sousuo' @click='search(word)'></i>
				<input type="text" placeholder="请输入工单号/设备编码" v-model='word' @keyup.enter='search(word)'>
			</span>
		</div>
		<div class='title spli'>
			<span>工单编号</span>
			<span>类型</span>
			<span>状态</span>
		</div>
		<ul class='content'>
			<li class='spli' v-for='li in list' @click='getDetail(li.number)'>
				<span v-text='li.number'></span>
				<span v-text='li.type'></span>
				<span v-text='li.status'></span>
			</li>
			<div class='loadmore' @click='loadmore' :style='{display: loadstyle}'>加载更多</div>
		</ul>
		<p class='notice' :style='{display: noticestyle}' v-text='notice'></p>
	</div>
	<script type="text/javascript" src="__PUBLIC__/Admin/layui/layui.js"></script>
	<script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
	<script>
		var service_record = new Vue({
			el: '#service_record',
			data () {
				return {
					word: '',			// 搜索框value
					status: '',			// 工单状态
					list: [],			// 数据列表
					page: '',			// 分页
					loadstyle: 'block',
					colorList: ['color:#f16e65;', 'color:#2196F3;', 'color:#2196F3;', 'color:#00d4c2;'],
					typeList: ['安装', '维护', '维修'],
					statusList: ['未派工', '处理中', '待评价', '已完成'],
					notice: '正在加载...',
					noticestyle: 'block',
				}
			},
			created (){
				var vm = this;
				var list = [
					{number: '2018060112345', type: '0', status: '0'},
					{number: '2018060111235', type: '1', status: '1'},
					{number: '2018060114545', type: '2', status: '2'},
					{number: '2018060112455', type: '0', status: '0'},
					{number: '2018060112125', type: '3', status: '3'},
					{number: '2018060118945', type: '1', status: '1'},
				];
				for(var i=0; i<list.length; i++){
					vm.list.push({
						number: list[i].number,
						type: vm.typeList[+list[i].type],
						status: vm.statusList[+list[i].status]
					})
				}
				// result: 0待处理 1处理中 2待验收 3(完成)
				// 获取列表
				// this.getList(function(res){
				// 	console.log('res: ',res);
				// 	if(res.data.length){
				// 		for(var i=0; i<res.data.length; i++){
				// 			vm.list.push({
				// 				name: res.data[i].name,
				// 				number: res.data[i].number,
				// 				text: vm.titleList[+res.data[i].type],
				// 				style: vm.colorList[+res.data[i].type],
				// 				create_at: timetrans(res.data[i].create_at)
				// 			});
				// 		}
				// 		vm.noticestyle = 'none';
				// 	}else{
				// 		vm.notice = '查无数据';
				// 		vm.loadstyle = 'none';
				// 		layuiHint('查无数据');

				// 	}
				// 	servicelist.page = 1;
				// }, this.result);
			},
			methods: {
				// 获取列表数据
				getList (callback, result, page) {
					var vm = this;
					var option = {
						url: getURL('Home', 'Service/getList'),
						type: 'get',
						success: function(res){
							// console.log('res: ',res);
							if(res.status == 200){
								callback(res);
								
							}else{
								vm.loadstyle = 'none';
								layuiHint('查无数据');
							}
						},
						error: function(err){
							console.log('err: ',err);
							layuiHint('系统出错，请稍后再试');
						}
					}
					// 全部（result: 11）
					// result: 0待处理 1处理中 2待验收 3(完成)
					if(result){
						option['data'] = {result: result};
					}
					if(page){
						// 请求分页数据
						option['data'] = {result: result, p: servicelist.page};
					}
					// 获取数据
					$.ajax(option);
				},
				// 跳到详情界面
				getDetail (workid) {
					console.log('workid: ',workid);
					location.href = getURL('Home', 'Service/record_detail') +'?workid='+ workid;
				},
				// 加载更多
				loadmore () {
					var vm = this;
					console.log('result: ', vm.result);
					console.log('page: ', vm.page);
					// 请求分页数据
					this.getList(function(res){
						console.log('res: ',res);

						if(res.data.length){
							for(var i=0; i<res.data.length; i++){
								vm.list.push({
									name: res.data[i].name,
									number: res.data[i].number,
									text: vm.titleList[+res.data[i].type],
									style: vm.colorList[+res.data[i].type],
									create_at: timetrans(res.data[i].create_at)
								});
							}
							vm.page++;
						}else{
							vm.loadstyle = 'none';
							layuiHint('无更多数据');

						}
					}, vm.result, vm.page);
				},
				// 搜索
				search (word) {
					var vm = this;
					console.log('word: ',word);
					if(!word){
						layuiHint('请输入工单号');
						return
					}
					$.ajax({
						url: getURL('Home', 'Service/getList'),
						type: 'get',
						data: {result: vm.result, word: word},
						success: function(res){
							console.log('res: ',res);
							if(res.status == 200){
								vm.list = [];
								if(res.data.length){
									for(var i=0; i<res.data.length; i++){
										vm.list.push({
											name: res.data[i].name,
											number: res.data[i].number,
											text: vm.titleList[+res.data[i].type],
											style: vm.colorList[+res.data[i].type],
											create_at: timetrans(res.data[i].create_at)
										});
									}
								}else{
									layuiHint('查无数据');
								}
							}else{
								layuiHint('查无数据');
							}
						},
						error: function(err){
							console.log('err: ',err);
							layuiHint('系统出错，请稍后再试');
						}
					})
				}
			}
		})
	</script>
</body>
</html>