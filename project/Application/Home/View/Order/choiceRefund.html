<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0,minimal-ui" />
	<title>选择退款商品</title>
	<link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
	<script src="__PUBLIC__/Home/js/jquery-1.10.1.js"></script>
	<script src="__PUBLIC__/Home/js/public.js"></script>
	<style>
		body{
			font-size: 0.7rem;
		}
		/*一个item的样式*/
		.appContain>.item{
			height: 5.7rem;
			border-bottom:1px solid #F3F3F3;
			padding:0.666667rem 5%;
		}
		.item>.appLeft{
			float: left;
			width: 47%;
			height: 100%;
			line-height: 8rem;
		}
		.item>.appLeft>i{
		    float: left;
		    width: 16%;
		    height: 100%;
		    font-size: 1rem;
		    line-height: 5.5rem;
		    color: #5a5a5a;
		}
		.item>.appLeft>i.icon-xuanze{
			color: #56AAF1;
		}
		.item>.appLeft>span{
			float: left;
			width: 84%;
			height: 100%;
		}
		.item>.appLeft>span>img{
			width: 100%;
			line-height: 8rem;
		}
		/*item右边*/
		.item>.appRight{
			width: 50%;
			height: 100%;
			float: right;
		}
		.appRight>h4{
			line-height: 1.0rem;
			color: #5a5a5a;
		    font-size: 0.72rem;
		    font-weight: 700;
		}
		.appRight>.changTxt{
			padding: 2% 0;
			display:-webkit-box; 
			overflow:hidden;
			text-overflow:ellipsis;
			-webkit-box-orient:vertical;
			box-orient:vertical;
			-webkit-line-clamp:4; 
			line-clamp: 4; 
			color: #5A5A5A;
            font-size: 0.62rem;
		}
		.appRight>p{
			display: block;
			width: 100%;
			line-height: 1.5rem;
		}
		.appRight>p>b{
			color:#fc2a2b;
			font-size: 0.72rem;

		}
		.appRight>p>span{
			float: right;
			color: #5a5a5a;
			font-size: 0.72rem;
		}
		/*底部按钮*/
		.appFoot{
			position: fixed;
			bottom: 0;
			height: 1.8rem;
			width: 100%;
			text-align: center;
			line-height: 1.8rem;
			 border-top:0.013333rem solid #f5f6f7;
		}
		.appFoot>span{
			display: inline-block;
		    width: 35%;
		    height: 1.8rem;
		    color: #5a5a5a;
		    font-size: 0.7rem;
		    padding-right: 15%;
		   
		}
		.appFoot>span>i{
			margin-right: 0.2rem;
			color: #5a5a5a;
			font-size: 1rem;
			float: left;
			margin-left:2.5rem;
			margin-right: 0;
		}
		.appFoot>input{
			width: 50%;    
			height: 100%;
			border:none;
			display: inline-block;
			background: #2EB6AA;
			color: #FFF;
			letter-spacing: 0.1rem;
			font-size: 0.72rem;
			float:right;
		}
		.icon-xuanze{
			color: #56AAF1!important;
		}
	</style>
</head>
<body>
	<div class="appContain">
		<div class="item clearfix">
			<div class="appLeft">
				<i class="iconfont confont icon-kuang1" gid="73"></i>
				<span><img src="__PUBLIC__/Home/images/ro_01_03.png" alt=""></span>
			</div>
			<div class="appRight">
				<h4>RO膜</h4>
				 <div class="changTxt">
					RO膜能够有效地去除水中钙、 镁、细菌、有机物、无机物、金 属离子和放射性物质属离子性物质属离子离子性物质属离子
				</div>
				<p><b>￥120.00</b><span>X1</span></p> 
			</div>
		</div>
	</div>
	<div class="appFoot">
		<span><i class="iconfont icon-kuang1"></i>全选</span><input type="submit" value="确定" class="selected">
	</div>
	<script>
		// 订单编号
		var order_id = location.search.substr(location.search.indexOf('=')+1);
		// console.log(order_id)
		// 存放当前订单商品
		var refundHTML = '';
		/*
			根据 订单号 请求商品数据
		 */ 
		$.ajax({
			url: '{{:U("Home/Order/choiceRefund")}}',
			type: 'post',
			data: {orderid: order_id},
			success: function(res){
				console.log('请求成功！',res);
				if(res.code == 200){
					for(var i=0; i<res.data.length; i++){

						var productbrief = res.data[i].productbrief ? res.data[i].productbrief : '暂无描述';
						refundHTML += '<div class="item clearfix">'+
								'<div class="appLeft">'+
									'<i class="iconfont icon-xuanze" gid="'+ res.data[i].gid +'" price="'+ res.data[i].price +'" num="'+ res.data[i].productnumber +'" path="/Uploads/'+ res.data[i].orderimg +'"></i>'+
									'<span><img src="/Uploads/'+ res.data[i].orderimg +'" alt=""></span>'+
								'</div>'+
								'<div class="appRight">'+
									'<h4 class="title" text="'+ res.data[i].productname +'">'+ res.data[i].productname +'</h4>'+
									 '<div class="changTxt">'+ productbrief +'</div>'+
									'<p><b>￥'+ res.data[i].price +'</b><span>X'+ res.data[i].productnumber +'</span></p>'+
								'</div>'+
							'</div>';
					}
					// console.log(refundHTML);
					//将数据添加到页面
					$('.appContain').append(refundHTML);
				}else{
					console.log('遇到问题!');
				}
			},
			error: function(res){
				console.log('请求失败！',res);
			}
		})
		// 选中框
		$('.item>.appLeft>i').click(function(){
			var _class=$(this).attr('class');
			
			if(_class=='iconfont icon-xuanze'){
				$(this).removeClass('iconfont icon-xuanze').addClass('iconfont icon-kuang1');
			}else{
				$(this).removeClass('iconfont icon-kuang1').addClass('iconfont icon-xuanze');	
			}
		})
		// 全选事件
		$('.appFoot>span>i').click(function(){
			var _quanclass=$(this).attr('class');
			
			if(_quanclass=='iconfont icon-kuang1'){
				$(this).removeClass('iconfont icon-kuang1').addClass('iconfont icon-xuanze');
				var _class=$('.item>.appLeft>i').attr('class');
				$('.item>.appLeft>i').removeClass(_class).addClass('iconfont icon-xuanze');
			}else{
				$(this).removeClass('iconfont icon-xuanze').addClass('iconfont icon-kuang1');
				var _class=$('.item>.appLeft>i').attr('class');
				$('.item>.appLeft>i').removeClass(_class).addClass('iconfont icon-kuang1')
			}	
		})
		/*
			点击确定
		 */ 
		$(".selected").click(function(){
			/*
				order_id: 订单编号
				title: 商品名称,
				path: 图片路径,
				gid: 商品id,
				price: 商品单价,
				num: 商品数量,
				brief: 商品描述
			 */
			var _this = $(this);
			var goodsArr = [];	// 选择的商品 id 集合, 给退款界面用
			console.log($(".title"))
			for(var i=0; i<$(".icon-xuanze").length; i++){
				//将数据存到本地存储，给退款界面用
				goodsArr.push({
					order_id: order_id,
					title: $(".title").eq(i).attr("text"),
					path: $(".icon-xuanze")[i].getAttribute("path"),
					gid: $(".icon-xuanze")[i].getAttribute("gid"),
					price: $(".icon-xuanze")[i].getAttribute("price"),
					num: $(".icon-xuanze")[i].getAttribute("num"),
					brief: $(".changTxt")[i].innerText
				})
				
			}
			console.log(goodsArr);
			// 如果有选择商品
			if(goodsArr.length){
				// 存到本地存储
				sessionStorage.setItem('goodsInfo', JSON.stringify(goodsArr));
				var gidStr = '';	//选择的所有商品gid字符串
				// 将商品 id 集合到一起，放到地址栏URL
				for(var i=0; i<goodsArr.length; i++){

					gidStr += 'gid=' + goodsArr[i].gid + '&';
				}
				gidStr = gidStr.substr(0, gidStr.length-1);	//去掉最后一个 '&'
				console.log(gidStr);
				// 跳到 退款提交界面
				location.href = "{{:U('Home/Order/applicRefund')}}?" + gidStr;
			}
		});
	</script>
</body>
</html>