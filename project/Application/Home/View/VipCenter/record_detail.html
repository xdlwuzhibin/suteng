<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name='viewport' content='width=device-width,initial-scale=1.0,user-scalable=no'>
	<title>工单详情</title>
	<link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfontHome.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/vipcenter/record_detail.css">
	<script src='__PUBLIC__/Home/js/vue.min.js'></script>
	<script src='__PUBLIC__/Home/js/public.js'></script>
</head>
<body>
	<div id='recoed_detail'>
		<div class='content'>
			<ul class='timeline' v-for='d in detailList'>
				<li class='cfix'>
					<b class='fl' v-text='d.title'></b>
					<span class='fr' v-text='d.time'></span>
				</li>
				<li v-html='d.content'></li>
			</ul>
		</div>
		<p class='notice' :style='{display: noticestyle}' v-text='notice'></p>
		<button v-show='showEval' class='evaluate' @click='evaluate'>评价</button>
		<div class='evalPanel' :style='evalPanel'>
			<h3>评论本次服务</h3>
			<ul>
				<li class='xinx'>
					<span class="iconfont icon-xingxing" :class='{activeClass: num >= 1}' @click='xingx(1)'></span>
					<span class="iconfont icon-xingxing" :class='{activeClass: num >= 2}' @click='xingx(2)'></span>
					<span class="iconfont icon-xingxing" :class='{activeClass: num >= 3}' @click='xingx(3)'></span>
					<span class="iconfont icon-xingxing" :class='{activeClass: num >= 4}' @click='xingx(4)'></span>
					<span class="iconfont icon-xingxing" :class='{activeClass: num == 5}' @click='xingx(5)'></span>
				</li>
				<li class='text'>
					<span v-for='text in textList' v-text='text' @click='textSelect($event)'></span>
				</li>
				<li>
					<label for="" style='padding-left: 4vw;'>其他想对师傅说的话</label>
					<textarea name="" id="" cols="30" rows="6" placeholder="随便说说吧"></textarea>
				</li>
				<button class='evaluate'>匿名提交</button>
			</ul>
		</div>
	</div>
	<script type="text/javascript" src="__PUBLIC__/Admin/layui/layui.js"></script>
	<script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
	<script>
		var recoed_detail = new Vue({
			el: '#recoed_detail',
			data () {
				return {
					notice: '正在加载...',
					noticestyle: 'block',
					workid: GetQueryString('workid'),
					detailList: [],
					showEval: false,
					evalPanel: '',
					textList: ['不错', '态度好', '守时', '效率高', '长得帅', '说话好听'],
					num: '',
				}
			},
			created (){
				var vm = this;
				vm.getDetail(vm.workid);

				hashchangeFn(function(hash){
					if(hash.indexOf('#evaluate') < 0){
						// 隐藏
						vm.evalPanel = 'transform:translateY(100%)';
					}else{
						// 显示
						vm.evalPanel = 'transform:translateY(0%)';
					}
				})

				// 监听hashchange事件
				function hashchangeFn(callback) {
					var haschangeflag = false;
					window.addEventListener('hashchange', function(){
						haschangeflag = true;
						callback(location.hash);
					}, false);
					// console.log('haschangeflag: ',haschangeflag);
					// console.log('hash: ',location.hash);
					// 刷新保持
					if(!haschangeflag){
						callback(location.hash);
					}
				}

				vm.getEvaluate();
			},
			methods: {
				// 获取详情数据
				getDetail (workid) {
					var vm = this;
					console.log('workid: ',workid);
					$.ajax({
						url: getURL('Home', 'vipCenter/showWorkTimeInfo'),
						type: 'post',
						data: {number: workid},
						success: function(res){
							console.log('res: ',res);
                            if(res.status == 200){
                            	if(res.data.length){
                            		vm.noticestyle = "none";
									vm.detailList = res.data;
									for(var i=0; i<res.data.length; i++){
										if(res.data[i].content.indexOf('评价') > 0){
											// 获取评价的数据
											vm.getEvaluate(workid);
											vm.showEval = 'true';
										}
									}
								}else{
                            		vm.notice = "查无数据";
									layuiHint('查无数据');
								}
							}else{
								layuiHint(res.msg);
							}
                        },
						error: function(err){
							console.log('err: ',err);
						}
					})
				},
				// 获取评论的数据
				getEvaluate (workid) {
					var vm = this;
					$.ajax({
						url: getURL('Home', 'Work/getEvaluate'),
						type: 'get',
						data: {number: workid},
						success: function(res){
							console.log('res: ',res);
						},
						error: function(err){
							console.log('err: ',err);
						}
					})
				},
				// 点击评论按钮
				evaluate () {
					var vm = this;
					vm.evalPanel = 'transform:translateY(0);';
					location.href = location.href + '#evaluate';
				},
				// 点击星星
				xingx (index) {
					this.num = index;
					console.log('num: ',this.num);
				},
				textSelect (e) {
					var el = e.currentTarget;
					var elclass = el.getAttribute('class');
					if(elclass == 'eval'){
						el.setAttribute('class', '');
					}else{
						el.setAttribute('class', 'eval');
					}
				},
				// 提交评论数据
				upEval () {
					var vm = this;
					var workid = vm.workid;
				}
			}
		})
	</script>
</body>
</html>