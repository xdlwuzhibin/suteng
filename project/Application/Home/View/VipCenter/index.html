<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
	<script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
    <script src="__PUBLIC__/Home/js/public.js"></script>
	<title>会员中心</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		} 
		body {
			font-size: .7rem;
			color: #373737;
		}
		#header {
			width: 100vw;
			height: 24vh;
			display: flex;
			color: #fff;
			background: -webkit-radial-gradient(top left, #99FCEF 35%, #5B97EF);
		}
		#header>#hLeft {
			flex: 1;
			display: flex;
			align-items: center;
			justify-content: center;
			overflow: hidden;
		}
		/*头像*/
		#hLeft>img {
			width: 18vmin;
			height: 18vmin;
			display: block;
			border-radius: 18vmin;
			color: #373737;
			background: #eee;
		}
		#header>#hRight {
			flex: 2;
		}
		#qrCode_share {
			width: 100%;
			height: 7vh;
			display: block;
			padding: 2% 6%;
    		text-align: right;
		}
		#qrCode_share>i{
			font-size: 1.2rem;
		}
		#qrCode_share>i:nth-of-type(2){
			font-size: 1.0rem;
		}
		/*我的钱包*/
		#package {
			display: flex;
			position: relative;
            top: 0.3rem;
		}
		#package >span{
			font-size: 0.8rem;
		}
		#package>div {
			margin-left: 2%;
			margin-top: -0.25rem;
			font-size: 0.72rem;
		}
		#content {
			width: 100vw;
			height: 76vh;
		}
		#income a p{
			padding-bottom: 4px;
		}
		#content>div {
			padding: 1% 2%;
			border-bottom: 8px solid #eee;
			font-size: 0.78rem;
			position: relative;
		}
		#package>div>p>i{
			position: relative;
			top:0.15rem;
		}
		#content>#more>div{
			border-bottom:1px solid #E5E5E5;
		}
		#content>#more>div:last-child{
			border:none;
		}
		#content>#more{
			border:none;
		}
		#content>div>p,
		#content>div>div {
			padding: 2.9% 0;
		}
		#content>div>p>a.chakan{
			float: right;
			font-size: 0.72rem;
		}
		#more>div {
			display: flex;
   		 	align-items: center;
		}
		#more>div>a {
			width: 100%;
			display: flex;
   		 	align-items: center;
   		 	clear:both;
		}
		
		#income>p>a {
			width: 100%;
			display: flex;
			position: relative;
			align-items: center;
			justify-content: space-between;
		}
		#indent>p>span:nth-of-type(2),
		#more>div>i {
			float: right;
		}
		#more>div>a>i:nth-of-type(1){
			display: inline-block;
		    width: 11%;
		    font-size: 1.4rem;
		}
		#more>div>a>i.icon-duihuan{
			color:#2EB6AA;
		    font-size: 1.48rem;

		}
		#more>div>a>i:nth-of-type(2){
			position: absolute;
			right: 2%;
			padding:0.4rem 0 0.2rem;
		}
		
		#indent>div {
			display: flex;
			justify-content: space-between;
		}
		#indent>div>a {
			text-align: center;
			font-size: .72rem;
		}
		#indent>div>a>i{
			
    		font-size: 1.8rem;
		}
		#indent>div>a>p{
			color: #808080;
			font-size: .65rem;
		}
		/*我的订单图标颜色*/
		.icon-zulin-{
			color:#028760;
		}
		.icon-shangpin-{
			color:#E38409;
		}
		.icon-haocai-{
			color:#0C4685;
		}
		.icon-duihuan-{
			color:#BD032B;
		}
		/*会员充值下面的四个图标颜色*/
		.icon-chongzhi1{
			color:#2EB6AA;
		}
		.icon-dizhi{
			color:#38A9EA;
		}
		.icon-yinhangqia{
			color:#F06325;
		}
		.icon-pinglun{
			color:#EE5641;
		}

		/*收益明细*/
		#income>div {
			display: flex;
		}
		#income>div>a {
			display: inline-block;
			padding: 1% 2%;
			text-align: center;
			border-radius: 5px;
			box-shadow: 0 0 6px #d8d8d8;
			font-size: 0.72rem;
		}
		#income>div>a:nth-of-type(1) {
			width: 60%;
			margin-right: 10px;
		}
		#income>div>a:nth-of-type(2) {
			width: 40%;
		}
		#income>div>a>span {
			display: inline-block;
			margin: 4px;
			color: #ED9571;
		}
		.icon-erweima{
			font-size: 1rem;
		}
		.icon-zhixiang {
			font-size: .8rem;
			margin-left: 0.5rem;
		}

		/*分享*/
		#sharePanel {
			width: 100vw;
			height: 100vh;
			display: none;
			position: fixed;
			top: 0;
			left: 0;
			font-size: .6rem;
			background: rgba(0,0,0, .5);
		}
		#maskbg {
			width: 100vw;
			height: 56vh;
		}
		#sharePart {
			width: 100vw;
			height: 44vh;
			position: absolute;
			bottom: -44vh;
			background: #eee;
		}
		/*金银币的图标颜色*/
		.icon-tubiao207{
			color:#f9df04; 
            font-size: 1.2rem;
            font-weight: 800;
			padding-right:0.2rem;
		}
		.icon-tubiao207-copy{
			color: #dadad5;
            font-size: 1.2rem;
            font-weight: 800;
			padding-right:0.2rem;
		}

		#sharePart>div {
			width: 96%;
			display: flex;
			flex-wrap: wrap;
			margin: 0 auto;
		}
		.shareIcon {
			width: 24vmin;
			height: 24vmin;
			display: flex;
			justify-content: center;
			align-items: center;
			flex-flow: column;
			margin: 5% 0;
		}
		.shareIcon>.img {
			width: 80%;
			height: 80%;
			display: flex;
			justify-content: center;
			align-items: center;
			background: #fff;
			background-size: 80%;
			background-position: center;
		}
		.shareIcon>.img:active {
			background: #e1e1e1;
		}
		.shareIcon>.img>img {
			width: 40%;
			margin: 10px 0;
		}
		.shareIcon>p {
			margin-top: 3%;
			text-align: center;
			white-space: nowrap;
		}
		/*点击右上角二维码*/
		#myCode {
			width: 100vw;
			height: 100vh;
			display: none;
			position: fixed;
    		top: 0;
    		left: 0;
			justify-content: center;
			align-items: center;
			flex-flow: column;
			background: #fff;
		}
		#qrcode {
			width: 50vmin;
			height: 50vmin;
			margin: 20vmin;
			background: url(__PUBLIC__/Home/images/erweima.png) no-repeat;
			background-size: 100% 100%;

		}
		#saveCode {
			width: 86%;
			margin: 0 auto;
			text-align: center;
			padding: 3%;
    		font-size: .8rem;
			color: #fff;
			border-radius: 4px;
			background: #2EB6AA;
		}
	</style>
</head>
<body>
	<header id="header">
		<div id="hLeft">
			<img src="{{$user['head']}}" alt="">
		</div>
		<div id="hRight">
			<div id="qrCode_share">
				<i class="iconfont icon-erweima"></i>
			</div>
			<p>{{$user['nickname']}}</p>
			<div id="package">
				<span>我的钱包：</span>
				<div>
					<p><i class="iconfont icon-tubiao207"></i>金币{{$user['gold_num']}}个</p>
					<p><i class="iconfont icon-tubiao207-copy"></i>银币{{$user['silver']}}个</p>
				</div>
			</div>
		</div>
	</header>
	<div id="content">
		<div id="indent">
			<p>
				<span>我的订单</span>
			</p>
			<div>
				<a href="{{:U('')}}">
					<i class="iconfont icon-zulin-"></i>
					<p>租赁订单</p>
				</a>
				
				<a href="{{:U('Home/Order/index')}}">
					<i class="iconfont icon-shangpin-"></i>
					<p>商品订单</p>
				</a>

				<a href="{{:U('Home/Order/consumable')}}">
					<i class="iconfont icon-haocai-"></i>
					<p>耗材订单</p>
				</a>
				<a href="{{:U('')}}">
					<i class="iconfont icon-duihuan-"></i>
					<p>兑换记录</p>
				</a>
			</div>
		</div>
		<div id="income">
			<p>
				<a href="{{:U('Home/VipCenter/reward')}}">
					<span>收益明细</span>
					<i class="iconfont icon-dayuhao-copy-copy"></i>
				</a>

			</p>
			<div>
				<a href="{{:U('Home/VipCenter/reward')}}">
					<span>金币{{$comData['gold_num']}}</span>
					<span>银币{{$comData['silver']}}</span>
					<p>我的奖励金</p>
				</a>
				<a href="{{:U('Home/Order/memberOrder')}}">
					<span>26</span>
					<p>会员订单</p>
				</a>
			</div>
		</div>
		<div id="more">
			<div id="pay">
				<a  href="{{:U('Home/Mall/chongzhi')}}">
					<i class="iconfont icon-duihuan"></i><!-- icon-duihuan- -->
					<p>兑换金银币</p>
					<i class="iconfont icon-dayuhao-copy-copy"></i>
				</a>
			</div>
			<div id="addressManage">
				<a href="{{:U('Home/Address/index')}}">
					<i class="iconfont icon-dizhi"></i>
					<p>收货地址管理</p>
					<i class="iconfont icon-dayuhao-copy-copy"></i>
				</a>
			</div>
			<div id="yinhanka">
				<a href="{{:U('Home/BankCard/index')}}">
					<i class="iconfont icon-yinhangqia"></i>
					<p>银行卡</p>
					<i class="iconfont icon-dayuhao-copy-copy"></i>
				</a>
			</div>
			<div id="comment">
				<a href="{{:U('Home/VipCenter/mycomment')}}">
					<i class="iconfont  icon-pinglun"></i>
					<p>我的评论</p>
					<i class="iconfont icon-dayuhao-copy-copy"></i>
				</a>
			</div>
		</div>
	</div>
	<div id="myCode">
		<img id="qrcode" src="__PUBLIC__/Home/images/erweima.png"></img>
		<a id="saveCode" href="javascript:;" >长按二维码保存到相册</a>
	</div>
	<canvas id="canvas" style="display: none"></canvas>
	<script src="__PUBLIC__/Home/js/jweixin-1.2.0.js"></script>
	<script>

		//微信接口
		wx.config({
		    debug: false,
		    appId: '{{$info["appId"]}}',
		    timestamp: '{{$info["timestamp"]}}',
		    nonceStr: '{{$info["nonceStr"]}}',
		    signature: '{{$info["signature"]}}',
		    jsApiList: [
		      // 所有要调用的 API 都要加到这个列表中
		      'chooseWXPay'
		    ]
		});
		/*
			点击右上角二维码
		 */
		$(".icon-erweima").on("click", function(){
			$("#myCode").css({display: 'flex'})
		})
		var canvas = document.getElementById("canvas"), img;
		var img = $("#qrcode")[0];

		//二维码的保存时消失
		$('#saveCode').click(function(){
			$('#myCode').css('display','none');
			//将图片使用canvas绘制
			img2canvas(img);
			//将二维码存至手机相册
			Download();
		})
		//将图片使用canvas绘制
		function img2canvas(img){
			canvas.width = img.width;
			canvas.height = img.height;
			canvas.getContext("2d").drawImage(img,0,0,img.width,img.height);
			console.log(img)
			console.log(canvas)
			return canvas;
		}
		/*
			将二维码存至手机相册
		 */
		function Download(){
	        //cavas 保存图片到本地  js 实现
	        //------------------------------------------------------------------------
	        //1.确定图片的类型  获取到的图片格式 data:image/Png;base64,...... 
	        var type ='png';//你想要什么图片格式 就选什么吧
	        var d=document.getElementById("canvas");
	        var imgdata=d.toDataURL(type);
	        //2.0 将mime-type改为image/octet-stream,强制让浏览器下载
	        var fixtype=function(type){
	            type=type.toLocaleLowerCase().replace(/jpg/i,'jpeg');
	            var r=type.match(/png|jpeg|bmp|gif/)[0];
	            return 'image/'+r;
	        };
	        imgdata=imgdata.replace(fixtype(type),'image/octet-stream');
	        //3.0 将图片保存到本地
	        var savaFile=function(data,filename)
	        {
	            var save_link=document.createElementNS('http://www.w3.org/1999/xhtml', 'a');
	            save_link.href=data;
	            save_link.download=filename;
	            var event=document.createEvent('MouseEvents');
	            event.initMouseEvent('click',true,false,window,0,0,0,0,0,false,false,false,false,0,null);
	            save_link.dispatchEvent(event);
	        };
	        var filename=''+new Date().getSeconds()+'.'+type;  
	        //我想用当前秒是可以解决重名的问题了 不行你就换成毫秒
	        savaFile(imgdata,filename);
        };

	</script>
</body>
</html>