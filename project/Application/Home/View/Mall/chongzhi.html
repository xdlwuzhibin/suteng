<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
	<script src="__PUBLIC__/Home/js/public.js"></script>
	<link rel="stylesheet" href="https://at.alicdn.com/t/font_527495_3mgodvjd6sp833di.css">
	<script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
	<title>会员充值</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		body {
			font-size: .7rem;
			overflow-x: hidden;
			color:#373737;
		}
		#content {
			width: 100vw;
			height: 92vh;
		}
		/*充值类型*/
		#content>div>p {
			padding: 2% 4% 3%;
			text-align: left;
			color: #5a5a5a;
			font-size: 0.72rem;

		}
		.taocan {
			padding: 2% 0;
			text-align: center;
		}
		.taocan>div {
			/*width: 30%;*/
			display: inline-block;
			padding: 3vmin 8vmin;
			/*margin: 5vmin;*/
			text-align: center;
			border-radius: 4px;
			border: 1px solid #e8e8e8;
		}
		
		.taocanSelectNow {
			color: #fff;
			border: 1px solid #56AAF1;
			background: #56AAF1;
		}
		.money {
			position: relative;
		}
		.money>div {
			width: 100%;
			position: absolute;
			background: #fff;
		}
		.money>div>div {
			width: 70%;
			position: relative;
			top: 0;
			padding: 3vmin 8vmin;
			margin: 2vh auto;
			border-radius: 4px;
			border: 1px solid #e8e8e8;
			text-align: center;
		}
		.money>div:nth-of-type(2) {
			left: 100vw;
		}
		.money>div:nth-of-type(3) {
			left: 200vw;
		}
		#footer {
			width: 100vw;
			height: 8vh;
			line-height: 8vh;
			color: #fff;
			font-size: .9rem;
			text-align: center;
			background: #2EB6AA;
		}
		/*付款页面*/
		.paystyle{
			position:absolute;
			top:0;
			left: 0;
			width: 100vw;
			height: 100vh;
			display: none;
		}
		.paystyleTop{
			width: 100vw;
			height: 10vh;
			background: #000;
			opacity: 0.3;
		}
		.payContain{
			position: absolute;
			bottom: 0;
			height: 95vh;
			width: 100vw;
			/*opacity: 0.5;*/
			z-index: 999;
			background: #FFF;
		}
		.payContain>.paytop{
			padding:0.5rem;
    		border-bottom: 1px solid #E5E5E5;
		}
		.paytop>.paytopLeft>i{
			float: left;
    		padding: 0.6rem 0;
    		margin-right: 4rem;
    		font-size: 1.5rem;
		}
		/*支付图标的颜色*/
		.icon-jinbi{
			color:#FEDA02;
		}
		.icon-yingbi{
			color:#97C3C0;
			
		}
		.icon-z-weixin{
			color:#149E23;
			
		}
		.icon-zhifubao{
			color:#22A8FF;
			
		}
		.icon-yinhang-yinlian-{
			color:#6BB5BB;
			
		}
		.paytop>.paytopRight{
			float: left;
    		text-align: center;
		}
		.icon-kuang1{
			color:#ccc;
		}
		.paytop>.paytopRight>h3{
			font-size: 0.9rem;
    		font-weight: 600;
    		padding: 0 0 0.5rem;
		}
		.paytop>.paytopRight>p{
			font-size: 0.9rem;
			font-weight: 600;
		}
		.paymidd>h3{
			padding:0.8rem;
		}
		.paymidd>ul>li{
			padding:0.6rem 0.5rem;
			border-bottom: 1px  solid #E5E5E5;
		}
		.paymidd>ul>li:nth-child(2){
			border-bottom: 6px  solid #E5E5E5;
			
		}
		.paymidd>ul>li>i{
			padding-right:0.4rem; 
			font-size: 1.2rem;
		}
		.paymidd>ul>li>span{
			float: right;
			font-size: 1rem;
		}
		.paymidd>ul>li>span.icon-xuanze{
			color: #4280EC;

		}
		/*底部按钮*/
		.payBott{
			width: 86vw;
			margin:5.5vh 7vw 0;
		}
		.payBott>input{
			border:none;
			padding:1vh  0;
			width: 86vw;
			background: #2EB6AA;
			border-radius:0.2rem;
			color: #FFF;
		}
		/*模态框样式*/
	  .modelAll{width:100vw;height:100vh;font-family: "mircoft yahei";font-size:14px;font-size: 0.7rem;line-height: 1; display: none;}
      .modal{position:absolute;left:0;right:0;z-index: -1;}
      .fade{opacity:0;top:-10%;display:block;-webkit-transition:top 0.3s linear;-o-transition:top 0.3s linear;transition:top 0.3s linear;}
      .fade.in{opacity:1;top:10%;}
      .modal-body{width:80%;margin:5rem auto;background-color: #fff;border-radius:0.5rem;}
      .modal-title{position:relative;height:40px;background-color: #D31145;line-height: 40px;border-bottom:1px solid #ccc;}
      .modal-backup{position:absolute;top:0;left:0;right:0;width:100%;height:100%;background-color: rgba(0, 0, 0, 0.5);z-index: 1000;display:none;}
      .modal-content>p{
      	padding:0.8rem;
      	text-align: center;
      	border-bottom:1px solid #E5E5E5;
      }
      .modal-content>p>a{
      	color:#64A0F2;
      }
      .modal-content>p>input{
      	border:none;
      	background: none;
      	color:#64A0F2;
      }
      .modal-content>p:nth-child(4){
      	border:none;
      }
	
	</style>
</head>
<body>
	<div id="content">
		<div class="taocan">
			<p>选择套餐类别</p>
			<div class="taocanSelectNow" index="0" >
				金币
			</div>
			<div index="1" >
				银币
			</div>
			<div index="2" >
				金币兑银币
			</div>
		</div>
		<div class="money">
			<p>选择充值金额</p>
			<!-- 金币 -->
			<div class="moneySon">
				<div alt="1" class="moneyItem taocanSelectNow">100元100个金币</div>
				<div alt="2" class="moneyItem">200元200个金币</div>
				<div alt="3" class="moneyItem">300元300个金币</div>
				<div alt="4" class="moneyItem">400元500个金币</div>
				<div alt="5" class="moneyItem">500元600个金币</div>
				
			</div>
			<!-- 银币 -->
			<div class="moneySon">
				<div alt="6" class="moneyItem taocanSelectNow">100元200个银币</div>
				<div alt="7" class="moneyItem">200元400个银币</div>
				<div alt="8" class="moneyItem">300元600个银币</div>
				<div alt="9" class="moneyItem">400元1000个银币</div>
				<div alt="10" class="moneyItem">500元1200个银币</div>
			</div>
			<div class="moneySon">
				<div alt="11" class="moneyItem taocanSelectNow">100金币兑200银币</div>
				<div alt="12" class="moneyItem">200金币兑400银币</div>
				<div alt="13" class="moneyItem">300金币兑600银币</div>
				<div alt="14" class="moneyItem">400金币兑800银币</div>
				<div alt="15" class="moneyItem">500金币兑1000银币</div>
			</div>
		</div>
	</div>
	<!-- 付款页面 -->
	<div class="paystyle">
		<div class="paystyleTop"></div>
		<div class="payContain">
			<div class="paytop clearfix">
				<div class="paytopLeft"><i class="iconfont icon-cuohao"></i></div>
				<div class="paytopRight">
					<h3>付款</h3>
					<p>￥3620.00</p>
				</div>	
			</div>
			<div class="paymidd">
				<h3>选择支付方式</h3>
				<ul class="clearfix">
				<!-- {{$user|dump}} -->
					<li><i class="iconfont icon-jinbi"></i>金币<span type="0" class="iconfont icon-kuang1"></span></li>
					<li><i class="iconfont icon-yingbi"></i>银币<span type="1" class="iconfont icon-kuang1"></span></li>
					<li><i class="iconfont icon-z-weixin"></i>微信支付<span type="2" class="iconfont icon-xuanze"></span></li>
					<li><i class="iconfont icon-zhifubao"></i>支付宝支付<span type="3" class="iconfont icon-kuang1"></span></li>
					<li><i class="iconfont icon-yinhang-yinlian-"></i>银联<span type="4" class="iconfont icon-kuang1"></span></li>
					<input type="hidden" id="gold" value="{{$user['gold_num']}}">
					<input type="hidden" id="silver" value="{{$user['silver']}}">
				</ul>
			</div>
			<div class="payBott">
				<input class="start" type="submit" value="立即支付">
			</div>
		</div>
	</div>
	<footer id="footer">
		立即充值
	</footer>
	<!-- 模态框的内容 -->
	<div class="modelAll">
		<!-- <a class="start" href="javascript:;">点击</a> -->
		<div class="modal fade">
			<div class="modal-body">
				<div class="modal-content">
					<p>您咱没有绑定银行卡</p>
					<p><a href="#">去绑定</a></p>
					<p><a href="#">其他支付方式</a></p>
					<p><input class="close" type="submit" value="取消"></p>
				</div>
			</div>
		</div>
		<div class="modal-backup"></div>
	</div>
	<!-- 微信支付支持JS部分代码 -->
	<script src="__PUBLIC__/Home/js/jweixin-1.2.0.js"></script>	                                                                                     
	<script>
		//微信接口
		wx.config({
		    debug: false,
		    appId: '{{$info["appId"]}}',
		    timestamp: '{{$info["timestamp"]}}',
		    nonceStr: '{{$info["nonceStr"]}}',
		    signature: '{{$info["signature"]}}',
		    jsApiList: [
		      // 所有要调用的 API 都要加到这个列表中
		      'chooseWXPay'
		    ]
		});
		$(".taocan div").on("click", function(){
			$(this).addClass('taocanSelectNow').siblings().removeClass("taocanSelectNow");

			// $(this).attr("index") == 0 
			// ? (
			// 	$(".moneySon").eq(0).animate({left: '0vw'}),
			// 	$(".moneySon").eq(1).animate({left: '100vw'}),
			// 	$(".moneySon").eq(2).animate({left: '200vw'})

			// ) 
			// : (
			// 	$(".moneySon").eq(0).animate({left: '100vw'}),
			// 	$(".moneySon").eq(1).animate({left: '0vw'}),
			// 	$(".moneySon").eq(2).animate({left: '-100vw'})

			// )
			var _index=$(this).attr("index");
			if(_index==0){
				$(".moneySon").eq(0).animate({left: '0vw'}),
				$(".moneySon").eq(1).animate({left: '100vw'}),
				$(".moneySon").eq(2).animate({left: '200vw'})
				// $('#footer').click(function
			}else if(_index==1){
				$(".moneySon").eq(0).animate({left: '-100vw'}),
			 	$(".moneySon").eq(1).animate({left: '0vw'}),
			 	$(".moneySon").eq(2).animate({left: '100vw'})
			}else if(_index==2){
				$(".moneySon").eq(0).animate({left: '-200vw'}),
			 	$(".moneySon").eq(1).animate({left: '-100vw'}),
			 	$(".moneySon").eq(2).animate({left: '0vw'})
			}
			
		})

		$(".moneyItem").each(function(key, value){

			$(value).on("click", function(){

				$(value).addClass('taocanSelectNow').siblings().removeClass("taocanSelectNow");
			});
			
		})
		//支付方式
		$('#footer').click(function(){
			// 支付类型
			var type = $('.clearfix li span.icon-xuanze').attr('type');
			// 显示支付金额
			showje(type);
			// 显示模态框
			$('.paystyle').slideDown("slow");
		})
		// 付款方式的单选框
		$('.paymidd>ul>li>span').click(function(){
			$('.paymidd>ul>li>span').removeClass('iconfont icon-xuanze').addClass('iconfont icon-kuang1');
			$(this).removeClass('iconfont icon-kuang1').addClass('iconfont icon-xuanze');
			//console.dir($(this).attr('type'));
			var type = $(this).attr('type');
			// 显示支付金额
			showje(type);
		})
		// 付款方式页面隐藏
		$('.paytop>.paytopLeft>i').click(function(){
			$('.paystyle').slideUp("slow");
		})
		// 模态框的js
		$(function(){
			// 点击立即支付
	      	$(".start").on("click",function(){
	       	   // $(".modal").addClass("in");
	       	   // $(".modal").css('z-index','1001');
	       	   // $(".modelAll").css('display','block');
	       	   // $(".modal-backup").css('display','block');
	       		// 获取支付类型
	       	   	var type = $('.clearfix li span.icon-xuanze').attr('type');
	       	   	// 获取购买产品的ID号
	       	   	var id = getPayId();
	       	   	//console.dir(id); 
	       	   	// 匹配支付类型，请求支付接口
		        switch (type) {
		            case '0':
		            	// 金币支付
		            	console.dir('金币支付');
		                break;
		            case '1':
		            	// 银币支付
		            	console.dir('银币支付');
		                break;
		            case '2':
		            	// 微信支付
		            	console.dir('微信支付');
						$.post('{{:U("Home/PaymentSystem/wxchongzhi")}}',{ 'id':id }, function(res){
							// 调用微信支付
							weixinPay(res);
							console.dir(res);
						});	
		                break;
		            case '3':
		            	// 支付宝支付
		            	console.dir('支付宝支付');
		                break;
		            case '4':
		            	// 银联支付
		            	console.dir('银联支付');
		                break;
		                break;
		            default:
		                //# code...
		                break;
		        }	
	       });
	      	$(".close").on("click",function(){
	       	   $(".modal").removeClass('in');
	       	   $(".modal").css('z-index','-1');
	       	   $(".modal-backup").fadeOut('slow');
	       });
      	})

		// 显示支付金额的方法
		function showje(type){
			//var type = $(this).attr('type');
			// 实例化金额数组
			var je = [
						[
							'100金币',
							'200金币',
							'300金币',
							'400金币',
							'500金币',
							'100金币',
							'200金币',
							'300金币',
							'400金币',
							'500金币',
							'100金币',
							'200金币',
							'300金币',
							'400金币',
							'500金币',
						],
						[
							'200银币',
							'400银币',
							'600银币',
							'800银币',
							'1000银币',
							'200银币',
							'400银币',
							'600银币',
							'800银币',
							'1000银币',
							'200银币',
							'400银币',
							'600银币',
							'800银币',
							'1000银币',
						],
						[
							'￥100元',
							'￥200元',
							'￥300元',
							'￥400元',
							'￥500元',
							'￥100元',
							'￥200元',
							'￥300元',
							'￥400元',
							'￥500元',
							'￥100元',
							'￥200元',
							'￥300元',
							'￥400元',
							'￥500元',
						],
						[
							'￥100元',
							'￥200元',
							'￥300元',
							'￥400元',
							'￥500元',
							'￥100元',
							'￥200元',
							'￥300元',
							'￥400元',
							'￥500元',
							'￥100元',
							'￥200元',
							'￥300元',
							'￥400元',
							'￥500元',
						],
						[
							'￥100元',
							'￥200元',
							'￥300元',
							'￥400元',
							'￥500元',
							'￥100元',
							'￥200元',
							'￥300元',
							'￥400元',
							'￥500元',
							'￥100元',
							'￥200元',
							'￥300元',
							'￥400元',
							'￥500元',
						]
					];
			// 判断是从哪个页面跳转到立即支付
			var yemian = $('.moneySon');
			// 定义默认索引0
			var index = 0;
			// 循环遍历页面对象
			for (var i = yemian.length - 1; i >= 0; i--) {
				if($(yemian[i]).css('left')=='0px'){
					index = i;
				}
			}
			var id = $(yemian[index]).children('.taocanSelectNow').attr('alt')-1;
			// 修改模态框显示金额
			$('.paytopRight p').html(je[type][id]);
		}

		// 返回支付的ID好
		function getPayId(){
			// 判断是从哪个页面跳转到立即支付
			var yemian = $('.moneySon');
			// 定义默认索引0
			var index = 0;
			// 循环遍历页面对象
			for (var i = yemian.length - 1; i >= 0; i--) {
				if($(yemian[i]).css('left')=='0px'){
					index = i;
				}
			}
			var id = $(yemian[index]).children('.taocanSelectNow').attr('alt');
			return id;
		}

		// 微信支付方法
		function weixinPay(res){
		    WeixinJSBridge.invoke(
		        'getBrandWCPayRequest',
		        JSON.parse(res),
		        function(res){
		            if (res.err_msg.substr(-2) == 'ok') {
		                // 付款成功，跳转前台主页
		                location.href = "{{:U('Home/PaymentSystem/paytosuccess')}}";
		            } else if (res.err_msg.substr(-6) == 'cancel') {
		                    // 取消付款
		                    // 跳转到待付款订单页面
		                    location.href = "{{:U('Home/PaymentSystem/paytofailed')}}";
		            }else{
		                    // 付款失败
		                    // 跳转到待付款订单页面
		                    location.href = "{{:U('Home/PaymentSystem/paytofailed')}}";
		            }
		        }
		    );
		};
// array(23) {
//   ["id"] => string(1) "6"
//   ["open_id"] => string(28) "oQktJwL8ioR4DoxSQmikdzekbUyU"
//   ["office_code"] => NULL
//   ["vendora_code"] => NULL
//   ["vendorb_code"] => NULL
//   ["vendorc_code"] => NULL
//   ["vendori_code"] => NULL
//   ["invitation_code"] => NULL
//   ["code"] => string(11) "72BD5AFF61D"
//   ["invite"] => string(1) "5"
//   ["ticket"] => string(96) "gQHx8DwAAAAAAAAAAS5odHRwOi8vd2VpeGluLnFxLmNvbS9xLzAyLUJtMWtxMmJkOTAxR1I2bU5xMWYAAgSFAW9aAwQwhScA"
//   ["parameter"] => string(1) "4"
//   ["ticket_time"] => string(10) "1519814326"
//   ["nickname"] => string(21) "吴智彬-13425492760"
//   ["head"] => string(140) "http://wx.qlogo.cn/mmopen/Q3auHgzwzM4IUw4vejmKA64ib5YEGDyFzrOkCVqa7EasmHUxvGDb5dA9nfjQ7x0zffsF5hCiaEvZgnt7WHjpeEPjAB7ibq9nZu0Ep2fcqtaH84/132"
//   ["sex"] => string(1) "1"
//   ["area"] => string(6) "广东"
//   ["address"] => string(20) "中国 广东 广州"
//   ["gold_num"] => string(1) "0"
//   ["silver"] => string(1) "0"
//   ["balance"] => string(4) "0.00"
//   ["addtime"] => string(10) "1517224326"
//   ["updatetime"] => string(10) "1517224326"
// }
	</script>
</body>
</html>