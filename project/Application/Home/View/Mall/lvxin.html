<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
	<title>滤芯</title>
	<style>
		* {
            margin: 0;
            padding: 0;
            -webkit-box-sizing: border-box;
                    box-sizing: border-box;
        }
        body {
            overflow-x: hidden;
            font-size: 0.7rem;
            color:#373737;
        }
        #content {
            width: 300vw;
            height: 84vh;
            position: relative;
            margin-top: 8vh;
            left: -200vw;
            margin-bottom: 8vh;
        }
        #header, #footer {
            width: 100vw;
            height: 8vh;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-pack: distribute;
                justify-content: space-around;
            -webkit-box-align: center;
                -ms-flex-align: center;
                    align-items: center;
            position: fixed;
            font-size: .8rem;
            background: #fff;
            z-index: 999;
        }
        #header {
            top: 0;
            left: 0;
            border-bottom: 1vh solid #ddd;
            height: 9vh;
        }
        ._float_right{
        	float: right;
        }
        #header>span {
            width: 33.33%;
            height: 8vh;
            line-height: 8vh;
            text-align: center;
            vertical-align: middle;
        }
        /*滤芯详情，滤芯复位，滤芯购买*/
        #lvxinDetail,
        #lvxinReset,
        #lvxinBuy {
            width: 100vw;
            /*height: 84vh;*/
            display: inline-block;
            position: absolute;
            top: 0;
            background: #fff;
        }
        #lvxinReset {
            left: 100vw;
         }
        #lvxinBuy{
            left: 200vw;
        }
        /*顶栏下划线，移动位置改这里*/
        #line {
            width: 33.33vw;
            height: 1vh;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
                -ms-flex-pack: center;
                    justify-content: center;
            position: absolute;
            left: 0;
            bottom: 0vh;
            margin-bottom: -1vh;
            margin-left: 66.66%;
            text-align: center;
            -webkit-transition: .2s ease;
            transition: .2s ease;
        }
        #line>span {
            width: 50%;
            height: 100%;
            display: block;
            position: relative;
            top: 0;
            border-radius: 20px;
            background: #76BAF3;
        }
		/*
			滤芯开始
		*/
        #ulDiv {
        	height: 10vh;
        	position: fixed;
            top: 0;
        	background: #fff;
        	z-index: 999;
        }
        #lvxinDetailUL>._padding,
        #lvxinReset>._padding {
            margin-bottom: 3vh;
        }
        #ulDiv>ul>li {
            height: 9vh;
            line-height: 9vh;
            vertical-align: middle;
            font-size: .5rem;
        }
        ._ul li:nth-of-type(1) {
            color: #039CE9;
            font-weight: normal;
        }
        
        ._ul li:nth-of-type(2) {
            color: #6F6F6F;
            font-weight: normal;
        }
        ._btn {
            background: #039CE9;
        }
		._padding{
		    padding:10px 25px 0 10px;
		    position: relative;
		}
		._padding>p {
			margin: 1vh 0;
		}
		._progress{
		    height: 4px;
		    display: flex;
		    align-items: center;
		    margin: 3vh auto;
		    border-radius: 10px;
		    background: #dfdfdf;
		    overflow: visible;
		}
		.progress-bar {
		    height: 12px;
		    border-radius: 6px;
		    background: #039CE9;
		    background-size: 10px 10px;
		    background-image: linear-gradient(-45deg, rgba(255, 255, 255, .2) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, .2) 50%, rgba(255, 255, 255, .2) 75%, transparent 75%, transparent);
		    background-image: -webkit-linear-gradient(-45deg, rgba(255, 255, 255, .2) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, .2) 50%, rgba(255, 255, 255, .2) 75%, transparent 75%, transparent);
		    background-image: -o-linear-gradient(-45deg, rgba(255, 255, 255, .2) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, .2) 50%, rgba(255, 255, 255, .2) 75%, transparent 75%, transparent);
		}
		#lvxinIntroduce {
	        margin: 2vh 0;
	    }
	    #lvxinIntroduce>div {
	        padding: 2vh 1vh;
	        border-bottom: 1px solid #ccc;
	    }
	    #lvxinIntroduce>div:nth-of-type(1) {
	        border-top: 1px solid #ccc;
	    }
	    #lvxinDetailUL .iconfont {
	        display: none;
	    }
		#lvxinReset p{
			padding-left:10vw; 
		}
	    .progress {
	        position: relative;
	        margin-left: 10vw;
	    }
	    .progress>.iconfont {
	        width: 6vw;
	        height: 6vw;   
	        display: flex;
	        justify-content: center;
	        align-items: center;
	        position: absolute;
	        top: -4vw;
	        left: 0;
	        margin-left: -6vh;
	        right: 15px;
			font-size: 1rem;
	    }
	    .progress>.icon-kuang1 {
		    color: #ccc;
		}
		.progress>.icon-xuanze {
		    color:#039CE9
		}
	    .progress>.checkbox>input[type="checkbox"]:checked {
	        background: #7D7FCE;
	    }
		/****** 滤芯结束 *******/
        /*商品*/
        .goods {
            width: 94vw;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            position: relative;
            padding: 3% 0;
            left: 50%;
            margin-left: -47%;
            border-bottom: 1px solid #eee;
            font-size: .6rem;
        }

        /*商品图片*/
        .goods>.img {
            width: 36%;
            margin: 2% 2% 2% 0;
        }   
        .goods>.img>img {
            width: 100%;
            height:100%;
            border-radius: 10px;
        }
        /*商品描述*/
        .goods>.desc {
            width: 64%;
            padding: 2% 0 2% 2%;
            background: #fff;
        }
        .goods>.desc>h5{
        	font-size: 0.72rem;
			font-weight: 500;
			color: #5a5a5a;
        }
        /*价格和数量*/
        .desc>div {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: justify;
            -ms-flex-pack: justify;
            justify-content: space-between;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
           
        }
        .goods>.desc>p {
            font-size: .5rem;
            margin: 4% 0;
            color: #5a5a5a;
			font-size: 0.65rem;


        }

        /*商品数量*/
        .num {
            width: 35%;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
                -ms-flex-pack: center;
                    justify-content: center;
            -webkit-box-align: stretch;
                -ms-flex-align: stretch;
                    align-items: stretch;
        }

        /*商品价格*/
        .price {
            color:#fc2a2b;
            font-size: .72rem;
        }
        .num>input {
            width: 33%;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
                -ms-flex-pack: center;
                    justify-content: center;
            -webkit-box-align: center;
                -ms-flex-align: center;
                    align-items: center;
            text-align: center;
            font-size: 1rem;
            border: none;
            -webkit-appearance: none;
            border-radius: 4px;
        }
        .num>.number {
            width: 33%;
            margin: 0 4px;
            text-align: center;
            border-radius: 4px;
            border: 1px solid #a4a4a4;
            font-size: .8rem;
        }
        .footer {
            bottom: 0;
            left: 0;
            border-top: 1px solid #e0e0e0;
        }
        #footer>div, #footer>span {
            height: 8vh;    
            display: inline-block;
            line-height: 8vh;
            text-align: center;
            vertical-align: middle;
        }
        #footer>div {
            width: 60%;
        }
        #footer>div>span {
            color: #FC3132;
        }
        #footer>span {
            width: 40%;
            color: #fff;
            background: #2EB6AA;
        }
        #footer > button{
        	width: 80vw;
        	height: 10vw;
        	background: #2EB6AA;
        	color: #fff;
        	display: none;
        	border: none;
        	border-radius: 5px;
        	font-size: .8rem;
        }
         #lvxinDetailUL>._padding,
        #lvxinReset>._padding {
            margin-bottom: 3vh;
        }
         @media screen and (max-height:520px) {
           #lvxinDetailUL>._padding,
        	#lvxinReset>._padding {
           		margin-bottom: 2.5vh;
        	}
      }
   
	</style>
</head>
<body>
	<header id="header">
		<span class="tabTitle" index="0">滤芯详情</span>
		<span class="tabTitle" index="1">滤芯复位</span>
		<span class="tabTitle" index="2">滤芯购买</span>
		<div id="line"><span></span></div>
	</header>
	<div id="content">
		<!-- 滤芯详情 -->
		<div id="lvxinDetail">
	        <div class="_background_color">
	            <!-- progress -->
	            <div>
	                <ul id="lvxinDetailUL"></ul>
	            </div>            
	            <!-- RO膜 -->
	            <div class="_padding" id="lvxinIntroduce">
	            </div>
	        </div>
		</div>
		<!-- 滤芯复位 -->
		<div id="lvxinReset_base">
	        <div class="_background_color _displey">
	            <!-- progress -->
				<ul id="lvxinReset">
				</ul>
	            <div class="_text_align">
	                <button class="_btn">立即复位</button>
	            </div>
	        </div>
		</div>
		<!-- 滤芯购买 -->
		<div id="lvxinBuy">
			<!-- <div class="goods">
					<div class="img"><img src="__PUBLIC__/Home/images/ro_01_03.png" alt="正在加载..."></div>
				<div class="desc">
					<h5>RO膜</h5>
					<p>RO膜能够有效地去除水中钙、镁、 细菌、有机物、无机物、金属离子和 放射性物质等</p>
					<div>
						<span class="price">￥<span>120.00</span></span>
						<span class="num">
							<input type="button" value="-" class="minus">
							<input class="number" type="number" value="0">
							<input type="button" value="+" class="plus">
						</span>
					</div>
				</div>
			</div> -->
			
		</div>
		<footer id="footer" class="footer">
			<div>合计：<span>￥0</span></div>
			<span id="pay">去结算</span>
			<button class="_btn" type="button">确定复位</button>
		</footer>
	</div>
	<script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
	<script src="__PUBLIC__/Home/js/filterpage.js"></script>
	<script src="__PUBLIC__/Home/js/public.js"></script>
	<script type="text/javascript" src="__PUBLIC__/Admin/layui/layui.js"></script>
	<link rel="stylesheet" href="__PUBLIC__/Admin/layui/css/layui.css" />
	<script type="text/javascript">
	
	var priceAll = 0;	//合计价格
	// 按加'+'号
	$("#lvxinBuy").on("touchend",".plus",function(){
		priceAll = 0;	//合计归零，后面重新计算
		// 获取数量
		var value = $(".number").val();
		$(this).siblings(".number")[0].value++;

		// 实时将总价格更新到合计
		for(var i=0; i<$(".goods").length; i++){
			if($(".goods").eq(i).find(".number")[0].value != 0){

				priceAll += parseFloat($(".goods").eq(i).find(".number")[0].value)*parseFloat($(".goods").eq(i).find(".price>span").text());
			}
		}
		// console.log(priceAll)
		$("#footer>div>span").text('￥'+priceAll)
	});

	//按减'-'号
	$("#lvxinBuy").on("touchend",".minus",function(){
		priceAll = 0;	//合计归零，后面重新计算
		// 获取数量
		var value = $(".number").val();
		for(var i=0; i<$(this).siblings(".number").length; i++){
			$(this).siblings(".number").val() <= 0
			? 0
			: $(this).siblings(".number")[i].value--
		}
		// console.log($(this).siblings(".number")[0].value);

		// 实时将总价格更新到合计
		for(var i=0; i<$(".goods").length; i++){
			if($(".goods").eq(i).find(".number")[0].value != 0){

				priceAll += parseFloat($(".goods").eq(i).find(".number")[0].value)*parseFloat($(".goods").eq(i).find(".price>span").text());
			}
		}
		// console.log(priceAll)
		priceAll = priceAll < 0 ? 0 : priceAll;
		$("#footer>div>span").text('￥'+priceAll)
	});
	//加载滤芯项
	var lvxinBuy = [ 
		{"filtername":"RO膜","filterbrief":"RO膜能够有效地去除水中钙、镁、 细菌、有机物、无机物、金属离子和 放射性物质等","filterprice":"120",'gid': 0}, 
		{"filtername":"滤芯膜","filterbrief":"滤芯是一个很好的饮水过滤原件。。。","filterprice":"120",'gid': 1}, 
		{"filtername":"净水膜","filterbrief":"滤芯是一个很好的饮水过滤原件。。。","filterprice":"120",'gid': 2}, 
	]; 
    var lvxinList='';
    for(var i = 0;i<lvxinBuy.length;i++){
    	lvxinList+='<div class="goods" gid="'+ lvxinBuy[i].gid +'">'+
					'<div class="img"><img src="__PUBLIC__/Home/images/ro_01_03.png" alt="正在加载..."></div>'+
				'<div class="desc">'+
					'<h5>'+ lvxinBuy[i].filtername +'</h5>'+
					'<p>'+ lvxinBuy[i].filterbrief +'</p>'+
					'<div>'+
						'<span class="price">￥<span>'+ lvxinBuy[i].filterprice +'</span></span>'+
						'<span class="num">'+
							'<input type="button" value="-" class="minus">'+
							'<input class="number" type="number" value="0">'+
							'<input type="button" value="+" class="plus">'+
						'</span>'+
					'</div>'+
				'</div>'+
			'</div>';
    }
    $("#lvxinBuy").html(lvxinList);

	/*
		filtername: 滤芯名称
		picturepath：图片路径
		desc：滤芯描述
		price：滤芯价格
		num：选择的数量
		priceAll：单一商品合计价格
        money: 单一商品总价钱，传给后台生成订单编号用
        gid: 商品id
	 */
	// 存储数量超过1的滤芯产品
	var lvxinData = [];
	var goods = $(".goods");
	// 点击‘去结算’
	$("#pay").click(function(){
		for(var i=0; i<goods.length;i++){
			if(goods.eq(i).find(".number").val() != 0){
				//这个priceAll是单一商品的价格合计
				var priceAll = parseInt(goods.eq(i).find(".price span").text())*parseInt(goods.eq(i).find(".number").val())
				lvxinData.push(
					{'filtername': goods.eq(i).find("h5").text(),
					'picturepath': goods.eq(i).find(".img img").attr("src"),
					'desc': goods.eq(i).find(".desc>p").text(),
					'price': parseInt(goods.eq(i).find(".price span").text()),
					'num': parseInt(goods.eq(i).find(".number").val()),
					'priceAll': priceAll,
                    'money': priceAll,
                    'gid': goods.eq(i).attr("gid")
					}
				)
			}
		}

		//清除其他页面的sessionStorage
		sessionStorage.setItem("goods_data", '');
		sessionStorage.setItem("shopCar_data", '');

		sessionStorage.setItem('lvxinData',JSON.stringify(lvxinData));
		console.log(lvxinData);
		// 选择滤芯后跳转
		if(lvxinData.length){
			// 发送ajax请求让后台生成订单号
			$.ajax({
				url: '{{:U("PaymentSystem/information")}}',
				type: 'post',
				data: {'data':JSON.stringify(lvxinData)},
				success: function(res){
					console.log('成功！', res);
					sessionStorage.setItem('order_id',res);
					// 跳转到订单确认页面
					location.href = '{{:U("PaymentSystem/payConfirm")}}';
				},
				error: function(res){
					console.log('失败！', res);
				}
			})
		}else{
			layui.use('layer', function(){
                var layer = layui.layer;
                layer.msg('请先选择需要购买的商品！');
            });
		}
		
	})
	</script>
</body>
</html>