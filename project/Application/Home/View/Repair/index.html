<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0,minimal-ui" />
  <meta charset="UTF-8">
  <title>报修主页</title>
  <link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
  <link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
  <link rel="stylesheet" href="__PUBLIC__/Home/css/repaire/index.css">
</head>
<body>
  <div class="_repair">
    <div class="repairContainer">
    <form action="add" method="post" enctype="multipart/form-data" id="form">
      <div class="repairTop">
        <ul>
          
          <li><span>设备编号：</span><p class="deviceid">0120563</p></li>
          <li><span>日       期：</span><p><input type="text" class="currentdate" id="currentdate" name="date" value="" placeholder="请选择日期"></p></li>
          <li><span>设备型号：</span><p><input type="text" class="devicetype"></p></li>
           <li>
            <span>报修原因：</span><p>
            <select name="reason">
                <option value ="volvo">-请选择-</option>
                <option value ="saab">更换滤芯</option>
                <option value="opel">微信端无法控制水机</option>
                <option value="audi">其他</option>
            </select></p>
            </li>
        </ul>
      </div>
      <div class="repairMidd">
          <h3>请写下您对设备的宝贵建议<span>*</span></h3>
          <textarea name="content" id="suggestTxt" cols="30" rows="10"></textarea>
          <p>上传截图</p>
          <div class="repairPic">
            <i class="iconfont icon-tianjia"></i>
            <span>限3张内</span>
            <input name="pic" class="repair-sendpic" multiple="true" type="file" accept="image/png, image/jpeg, image/gif, image/jpg" >
            <div id="picShow"></div>
            <div class="hide"></div>
          </div>
      </div>
      <div class="repairFoot">
        <ul>
          <h3>联系方式</h3>
          <li>
            <label for="Lname">
              <span>姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：</span><input id="Lname" type="text" name="truename" value="" placeholder="请输入姓名">
            </label>
          </li>
           <li>
            <label for="Ltel">
              <span>电&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;话：</span><input id="Ltel" type="text" name="phone" value="" placeholder="请输入电话">
            </label>
          </li>
          <li>
            <label for="Laddr">
              <p>维修地址：</p>
              <textarea name="address" id="Laddr" cols="30" rows="10" placeholder="" ></textarea>
            </label>
          </li>
        </ul>
      </div>
      <div class="repairBtn">
        <input type="submit" value="提交" class="btn">
      </div>
    </form>

  </div>
  <link rel="stylesheet" href="__PUBLIC__/Admin/layui/css/layui.css" />
  <script src="__PUBLIC__/Home/js/laydate.js"></script>
  <script src="__PUBLIC__/Home/js/jquery-1.10.1.js"></script>
  <script src="__PUBLIC__/Home/js/public.js"></script>
  <script type="text/javascript" src="__PUBLIC__/Admin/layui/layui.js"></script>
  <script type="text/javascript">
  $(function(){
    var device_now = sessionStorage.getItem("device_now");
    $(".deviceid").text(device_now);
    $("#currentdate").click(function(){

      //选择服务日期，
      laydate.render({
        elem: '#currentdate', //指定元素
        show: true,
        format: 'yyyy年MM月dd日',
        btns: ['clear', 'confirm'],
        min: 1
      });
    })
    var formdata = new FormData();
    var file = $(".repair-sendpic").files;
    var picArr = [];    //存储选择的待上传图片的base64编码格式
    var i=0;  //formdata存储序号
      // 上传的图片
      $(".repair-sendpic").on("change",function(e){
        var files = this.files;
        var span = $("<span></span>"),
          span1 = $("<span>X</span>"),
          img = $('<img src="" alt="" />');
        var reader =new FileReader();

        reader.readAsDataURL(files[0]);
        reader.onload = function(e){
          i++;
          picArr.push(this.result);
          var mb = (e.total/1024)/1024;
          if(mb>= 4){
            alert('文件大小大于4M');
            return;
          }
          img[0].src = this.result;
          img[0].width = "100%";
          img[0].height = "90%";
          
          // console.log(span, span[0]);
          span1.addClass("delPic");
          span1.css({zIndex: '999'});
          span.append(span1);
          span.append(img[0]);
          $('#picShow').append(span);
          // console.log(picArr)
          //formdata
          if(picArr.length > 2){
            for(var i=0; i<picArr.length; i++){
              formdata.append("picture"+i,picArr[i])
              // console.group('picture'+i+': ',formdata.get("picture"+i),i)
            }
          }
        }

        //最多选择三张图片
        if($("#picShow>span").length >= 2){
          $(".hide").show();
        }

      });

      // 点击上传的图片右上角的" x "，删除这张图片
      $("#picShow").on("click", ".delPic", function(){
        $(this).parent().remove();
        //最多选择三张图片
        if($("#picShow>span").length <= 2){
          i--;
          $(".hide").hide();
        }
      })

    //姓名验证 
    $('#Lname').change( function() {
        // 这里可以写些验证代码
        var name = $(this).val();
        if(name==name.match(/^[a-zA-Z\u4e00-\u9fa5]{2,30}$/u)){// 纯中文姓名支持支持 /^[\u4e00-\u9fa5]{2,30}$/u
          console.dir('验证通过');
        }else{
          layuiHint('请输入真实的姓名！');
        }
    });
    //手机号码验证
    $('#Ltel').change( function() {
        // 这里可以写些验证代码
        var phone = $(this).val();
        var rephone = phone.match(/^1((((3[0-35-9])|([5|8][0-9])|(4[5|7|9])|66|(7[3|5-8])|(9[8|9]))\d)|(34[0-8]))\d{7}$/);
        if(rephone){
          if(phone==rephone[0]){
            console.dir('验证通过');
          }else{
            console.dir('请输入正确的手机号码！');
          } 
        }else{
          console.dir('请输入正确的手机号码！');
        }

    });
    // 地址验证
    $('#Laddr').change( function() {
        // 这里可以写些验证代码
        var addr = $(this).val();
        if(addr==addr.match(/^[\w\-\u4e00-\u9fa5]{6,255}$/u)){// 公司地址，不为空时验证，数字字母下划线横线中文 6-255位
          console.dir('验证通过');
        }else{
          console.dir('地址格式不正确！');
        }
    });
    /*
      点击'提交'
     */
    $(".btn").click(function(){
      if($(".currentdate").val()==""){
        layuiHint("请选择日期");
        return false;

      }else if($(".devicetype").val()==""){
        layuiHint("请输入设备型号");
        return false;

      }else if($("select").val()==""){
        layuiHint("请选择保修原因");
        return false;

      }else if($(".suggestTxt").val()==""){
        layuiHint("请输入报修详情");
        return false;

      }else if(!(/^([a-zA-Z0-9_\u4e00-\u9fa5]){2,30}$/).test($("#Lname").val())){
         layuiHint("请输入真实姓名");
        return false;

      }else if(!(/^1[3|4|5|8][0-9]\d{4,8}$/.test($('#Ltel').val()))){ 
        layuiHint("请输入正确的手机号码");
        return false;

      }else if(!(/^(?=.*?[\u4E00-\u9FA5])[\dA-Za-z\u4E00-\u9FA5]{6,}/).test($("#Laddr").val())){
        layuiHint("请输入详细的报修地址");
        return false;

      }
    });
  })

  </script>
</body>
</html>                                                                                                                                                                                                                                                                      