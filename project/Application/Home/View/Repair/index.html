<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0,minimal-ui" />
  <meta charset="UTF-8">
  <title>报修主页</title>
  <link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
  <link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
  <link rel="stylesheet" href="__PUBLIC__/Home/css/repaire/index.css">
</head>
<body>
  <div class="_repair">
    <div class="repairContainer">
      <form action="" method="post" enctype="multipart/form-data" id="form">
        <div class="repairTop">
          <ul>
            
            <li>
              <span>设备编号：</span>
              <p>
                <select class="device_code" name="deviceid">
                    <option value="0">-- 请选择问题设备 --</option>
                    <option value="213124">213124</option>
                    <option value="435345">435345</option>
                    <option value="32323232">32323232</option>
                </select>
              </p>
            </li>
            <li><span>日&emsp;&emsp;期：</span><p><input type="text" class="currentdate" id="currentdate" name="date" value="" placeholder="-- 请选择服务日期 --"></p></li>
            <li><span>设备型号：</span><p><input type="text" class="devicetype"></p></li>
             <li>
              <span>报修原因：</span>
              <p>
                <select name="reason" class="reason">
                    <option value ="volvo">-- 请选择报修原因 --</option>
                    <option value ="saab">更换滤芯</option>
                    <option value="opel">微信端无法控制水机</option>
                    <option value="audi">其他</option>
                </select>
              </p>
              </li>
          </ul>
        </div>
        <div class="repairMidd">
            <h3>请写下您对设备的宝贵建议<span>*</span></h3>
            <textarea name="content" id="suggestTxt" cols="30" rows="10"></textarea>
            <p>上传截图</p>
            <div class="repairPic">
              <i class="iconfont icon-tianjia"></i>
              <span>限3张内</span>
              <input name="pic" class="repair-sendpic file_upload" multiple="true" type="file" accept="image/png, image/jpeg, image/gif, image/jpg" >
              <div id="picShow"></div>
              <div class="hide"></div>
            </div>
        </div>
        <div class="repairFoot">
          <ul>
            <h3>联系方式</h3>
            <li>
              <label for="Lname">
                <span>姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：</span><input id="Lname" type="text" name="truename" value="" placeholder="请输入姓名">
              </label>
            </li>
             <li>
              <label for="Ltel">
                <span>电&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;话：</span><input id="Ltel" type="text" name="phone" value="" placeholder="请输入电话">
              </label>
            </li>
            <li>
              <label for="Laddr">
                <p>维修地址：</p>
                <textarea name="address" id="Laddr" cols="30" rows="10" placeholder="" ></textarea>
              </label>
            </li>
          </ul>
        </div>
        <div class="repairBtn">
          <input type="button" value="提交" class="btn">
        </div>
      </form>
    </div>
  </div>
  <link rel="stylesheet" href="__PUBLIC__/Admin/layui/css/layui.css" />
  <script src="__PUBLIC__/Home/js/laydate.js"></script>
  <script src="__PUBLIC__/Home/js/jquery-1.10.1.js"></script>
  <script src="__PUBLIC__/Home/js/public.js"></script>
  <script type="text/javascript" src="__PUBLIC__/Admin/layui/layui.js"></script>
  <script src="__PUBLIC__/Home/js/upFile.js"></script>
  <script type="text/javascript">
  $(function(){
    var device_now = sessionStorage.getItem("device_now");
    $(".deviceid").text(device_now);
    // 选择日期
    $("#currentdate").click(function(){

      //选择服务日期，
      laydate.render({
        elem: '#currentdate', //指定元素
        show: true,
        format: 'yyyy年MM月dd日',
        btns: ['clear', 'confirm'],
        min: 1
      });

    })

    // //姓名验证 
    // $('#Lname').change( function() {
    //     // 这里可以写些验证代码
    //     var name = $(this).val();

    //     if(name==name.match(/^[a-zA-Z\u4e00-\u9fa5]{2,30}$/u)){// 纯中文姓名支持支持 /^[\u4e00-\u9fa5]{2,30}$/u
    //       console.dir('验证通过');

    //     }else{
    //       layuiHint('请输入真实的姓名！');

    //     }
    // });
    // //手机号码验证
    // $('#Ltel').change( function() {
    //     // 这里可以写些验证代码
    //     var phone = $(this).val();
    //     var rephone = phone.match(/^1((((3[0-35-9])|([5|8][0-9])|(4[5|7|9])|66|(7[3|5-8])|(9[8|9]))\d)|(34[0-8]))\d{7}$/);

    //     if(rephone){
    //       if(phone==rephone[0]){
    //         console.dir('验证通过');

    //       }else{
    //         console.dir('请输入正确的手机号码！');

    //       }
    //     }else{
    //       console.dir('请输入正确的手机号码！');
    //     }

    // });
    // // 地址验证
    // $('#Laddr').change( function() {
    //     // 这里可以写些验证代码
    //     var addr = $(this).val();
    //     if(addr==addr.match(/^[\w\-\u4e00-\u9fa5]{6,255}$/u)){// 公司地址，不为空时验证，数字字母下划线横线中文 6-255位
    //       console.dir('验证通过');
    //     }else{
    //       console.dir('地址格式不正确！');
    //     }
    // });
    /*
      点击'提交'
     */
    $(".btn").click(function(){
      /*
          date : 日期,
          device_code : 设备id,
          reason : 报修原因,
          suggestTxt : 建议,
          truename : 姓名,
          phone : 电话,
          address : 报修地址
       */
      var nameReg = /^([a-zA-Z0-9_\u4e00-\u9fa5]){2,30}$/;
      var phoneReg = /^1[3|4|5|8][0-9]\d{4,8}$/;
      var addressReg = /^(?=.*?[\u4E00-\u9FA5])[\dA-Za-z\u4E00-\u9FA5]{6,}/;
      var date = $(".currentdate").val().replace(/[年月]/g,'-').replace(/[日]/,''),
          device_code = $(".device_code>option:selected"),
          reason = $(".reason>option:selected"),
          content = $("#suggestTxt").val(),
          truename = $("#Lname").val(),
          phone = $("#Ltel").val(),
          address = $("#Laddr").val();

          console.log('device_code:', device_code[0].innerText + '\n' +
           'date:',date + '\n' + 'reason:', reason[0].innerText + '\n' + 
           'content:', content + '\n' + 'truename:', truename + '\n' + 
           'phone:', phone + '\n' + 'address:', address
           );

          //清空，防止多次点击提交
          formData.delete('device_code')
          formData.delete('date')
          formData.delete('reason')
          formData.delete('content')
          formData.delete('truename')
          formData.delete('phone')
          formData.delete('address')

          console.group();

          //重新添加
          formData.append('device_code', device_code[0].innerText)
          formData.append('date', date)
          formData.append('reason', reason[0].innerText)
          formData.append('content', content)
          formData.append('truename', truename)
          formData.append('phone', phone)
          formData.append('address', address)

          console.log(formData.getAll('device_code') + '\n' + formData.getAll('date') + '\n' +
           formData.getAll('reason') + '\n' + formData.getAll('content') + '\n' + 
           formData.getAll('truename') + '\n' + formData.getAll('phone') + '\n' + 
           formData.getAll('address') + '\n' + formData.getAll('UploadForm[]')
          );

          if(date && device_code.selectedIndex != 0 && reason.selectedIndex != 0 && content && truename && phone && address){
              console.log('通过！')

              /*
                 发送到后台
               */
              $.ajax({
                  url: '{{:U("Home/Repair/add")}}',
                  type: 'post',
                  data: formData,
                  cache: false,
                  processData: false,
                  contentType: false,
                  success: function(res){
                    console.log('请求成功！', res);

                  },
                  error: function(res){
                    console.log('请求成功！', res);

                  }
              })
            
          }else if($('.device_code')[0].selectedIndex == 0){
              console.log('请选择保修的设备！');
              layuiHint('请选择保修的设备！');
              return false;
              
          }else if(!date){
              console.log('请选择日期！');
              layuiHint('请选择日期！');
              return false;

          }else if($('.reason')[0].selectedIndex == 0){
              console.log('请选择报修原因！');
              layuiHint('请选择报修原因！');
              return false;
              
          }else if(!content){
              console.log('希望您提供宝贵的建议！');
              layuiHint('希望您提供宝贵的建议！');
              return false;
              
          }else if(!nameReg.test(truename)){
              console.log('请输入正确格式的姓名！');
              layuiHint('请输入正确格式的姓名！');
              return false;
              
          }else if(!phoneReg.test(phone)){
              console.log('请输入正确格式的手机号码！');
              layuiHint('请输入正确格式的手机号码！');
              return false;
              
          }else if(!addressReg.test(address)){
              console.log('请输入正确格式的地址！');
              layuiHint('请输入正确格式的地址！');
              return false;
              
          }
    });
  })

  </script>
</body>
</html>                                                                                                                                                                                                                                                                      