<!DOCTYPE html>
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0,minimal-ui" />
	<meta charset="UTF-8">
	<title>定时开关</title>
	<link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
	<link rel="stylesheet" href="__PUBLIC__/Home/css/switch/index.css">
</head>
<body>
	<div class="_setTime">
		<div class="_setTimecontain">
<!-- 			<hgroup>
				<div class="hgContain .clearfix">
					<div class="setLeft .clearfix">
						<p><span  class="sLeft">加热时间</span><span class="sRight"><b>21</b>时：<b>00</b>分</span>	</p>
					</div><div class="setRight">
						<div class="open1" name='one'>
       				 		<div class="open2" name='two'></div>
    					</div>
					</div>
					<div class="delBtn">
					<input type="submit" value="删除">
					</div>
					
				</div>
			</hgroup>	 -->	
		</div>
		<a href="{{:U('Home/Switch/setTime')}}">
			<div class="settimeFoot">
				<p><i class="iconfont icon-tianjia"></i><span>添加新设置</span></p>
			</div>
		</a>
	</div>
	<script src="__PUBLIC__/Home/js/jquery-1.10.1.js"></script>
	<script src="__PUBLIC__/Home/js/public.js"></script>
	<link href="__PUBLIC__/Admin/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
	<script src="__PUBLIC__/Admin/js/plugins/sweetalert/sweetalert.min.js"></script>
	<script>
		$(function(){
			// 首页按钮
		    !function(){
		      // 创建 a 标签
		      var home = document.createElement('a');
		      home.innerText = '首\n页';
		      
		      home.href = '{{:U("Home/VipCenter/minepack")}}';
		      home.setAttribute("id", 'back2Home');

		      // 添加到页面
		      document.body.appendChild(home);
		      home.onclick = function(){
		        home.style.background = '#aaa';
		      }
		      return
		      // console.log(home)
		    }()
		})
	  // 开关效果
    	// window.onload=function(){
     // 	 	$("div[name='two']").click(function(){
     // 	 		var divone=$(this).parent().attr('class');
     // 	        var divtwo=$(this).attr('class');
     // 	        // console.dir(divone);
     // 	 		if(divtwo=='close2'){
     // 	 			$(this).removeClass('close2').addClass('open2');
     // 	 			$(this).parent().removeClass('close1').addClass('open1');
     // 	 		}else if(divtwo=='open2'){
     // 	 			$(this).removeClass('open2').addClass('close2');
     // 	 			$(this).parent().removeClass('open1').addClass('close1');
     // 	 		}
     // 	 	});
    	// }
    	// // 删除的样式
    	// slipDel('hgroup','i')
    // 	var timeObj, timeHTML = '';
    // 	if(sessionStorage.getItem("timeObj")){
    // 		timeObj = JSON.parse(sessionStorage.getItem("timeObj"));
    // 		console.log(timeObj);
    // 		for(var i=0; i<timeObj.length; i++){
    // 			console.log(timeObj[i])
    // 			timeHTML += '<hgroup>'+
				// 	'<div class="hgContain .clearfix" i="1">'+
				// 		'<div class="setLeft .clearfix">'+
				// 			'<p><span  class="sLeft">关机时间</span><span class="sRight"><b>'+ timeObj[i].shutdown.slice(0,2) +'</b>时：<b>'+ timeObj[i].shutdown.slice(-2) +'</b>分</span>	</p>'+
				// 			'<p><span>开机时间</span><span class="sRight"><b>'+ timeObj[i].poweroff.slice(0,2) +'</b>时：<b>'+ timeObj[i].poweroff.slice(-2) +'</b>分</span></p>'+
				// 		'</div><div class="setRight">'+
				// 			'<div class="open1" name="one"><!-- id="divone" -->'+
	   //     				 		'<div class="open2" name="two"></div><!-- id="divtwo" -->'+
	   //  					'</div>'+
				// 		'</div>'+
				// 		'<div class="delBtn">'+
				// 		'<input type="submit" value="删除">'+
				// 		'</div>'+
				// 	'</div>'+
				// '</hgroup>';
    // 		}
    // 		console.log(timeHTML)
    // 		$("._setTimecontain").html(timeHTML)
    // 	}else{
    // 		timeHTML = '<div style="width: 100vw;height:50vh;display:flex;align-items:center;justify-content:center">暂无数据</div>';
    // 		$("._setTimecontain").html(timeHTML)
    // 	}


   	/**
   	 * [success description]
   	 * 请求:"{{:U('Home/Task/get_time')}}
   	 * 参数:
   	 * 		type   [0:开机，1：关机,2：开启加热，3：关闭加热，不传参：获取全部]
   	 * 		json 数据
     
   	 */
   	var html = '';
   	$.ajax({
	    url:"{{:U('Home/Task/get_time')}}",
	    // data:{type:},
	    dataType:"json",
	    type: 'post',
	    success:function(res){
	        // console.dir(res);
	        if(res.code == 200){
	            // 添加成功
	            // swal(res.msg,res.msg, "success");
	            if(res.data.length){
	            	//console.dir(res.data);
		            for (var i = res.data.length - 1; i >= 0; i--) {
		            	
				html += '<hgroup alt="'+res.data[i].id+'""><div class="hgContain .clearfix"><div class="setLeft .clearfix"><p><span  class="sLeft">';
				 switch (res.data[i].type) {
				     case '0':
				         html += '开机时间';
				         break;
				     case '1':
				         html += '关机时间';
				         break;
				     case '2':
				         html += '开启加热';
				         break;
				     case '3':
				         html += '关闭加热';
				         break;
				 }						
				
				html += '</span><span class="sRight"><b>'+res.data[i].hour+'</b>时：<b>'+res.data[i].minute+'</b>分';

				if(res.data[i].repeat==1){
					html+='<b>  每天</b></span></p>';
				}else{
					html+='<b>  一次</b></span></p>';
				}


				if(res.data[i].state==1){
					html += '</div><div class="setRight"><div class="open1" name="one"><div class="open2" name="two"></div>';
				}else{
					html += '</div><div class="setRight"><div class="close1" name="one"><div class="close2" name="two"></div>';
				}

				html += '</div></div><div class="delBtn delete" alt="'+res.data[i].id+'"></div></div></hgroup>';
		            }
	            }//然后

	        }else{
	            // 添加失败
	            // swal(res.msg, "请重新提交！", "success");
	           html += "<p style='padding:5px 0 0 10px'>暂无定时任务！请添加定时设置</p>";
	        }

	        $('._setTimecontain').html(html);

		    $("div[name='two']").click(function(){
		    	var divone=$(this).parent().attr('class');
		        var divtwo=$(this).attr('class');
		        // console.dir(divone);
		    	if(divtwo=='close2'){
		    		$(this).removeClass('close2').addClass('open2');
		    		$(this).parent().removeClass('close1').addClass('open1');
		    	}else if(divtwo=='open2'){
		    		$(this).removeClass('open2').addClass('close2');
		    		$(this).parent().removeClass('open1').addClass('close1');
		    	}
		    });

	    }
	});


   	// 删除按钮
	slipDel('._setTimecontain','hgroup','statenum');
	$('._setTimecontain').on('click','.del',function(e){
		// console.dir($(this).parent());
		// $(this).parent().remove();
		var id = $(this).parents('hgroup').attr('alt');
		var _this = $(this);
		// console.dir(id);
        $.ajax({ 
            url: "{{:U('Home/Task/del')}}",
            type: 'post',
            data: {'id': id},
            success: function(res){
                if(res.code == 200){
                    // 有数据，数据格式查看 26 行
                    $(_this).parents('hgroup').remove();
                }else{
                    // 无数据，数据格式查看 32 行
                    swal('删除失败',res.message, "error");
                }
            },
            error: function(err){
            	console.log('错误：',err);
            }
        });

	});
	$('._setTimecontain').on('click','.close1',function(){
        var id = $(this).parents('hgroup').attr('alt');
	    var _this = $(this);
        $.ajax({
            url:"{{:U('Home/Task/update')}}",
            dataType:"json",
            data:{'id':id},
            type: 'post',
            success:function(res){
                if(res.code == 200){
                    // 有数据，数据格式查看 26 行
                    swal('禁用成功',res.message, "success");
                }else{
                    // 无数据，数据格式查看 32 行
                    swal('禁用失败',res.message, "error");
                }
            }
        });
    });
      $('._setTimecontain').on('click','.open1',function(){
          var id = $(this).parents('hgroup').attr('alt');
          var _this = $(this);
          $.ajax({
              url:"{{:U('Home/Task/update')}}",
              dataType:"json",
              data:{'id':id},
              type: 'post',
              success:function(res){
                  if(res.code == 200){
                      // 有数据，数据格式查看 26 行
                      swal('启用成功',res.message, "success");
                  }else{
                      // 无数据，数据格式查看 32 行
                      swal('启用失败',res.message, "error");
                  }
              }
          });
      });


      // var id=
	  // $.ajax({
   //              url:"{{:U('Home/Task/del')}}",
   //              dataType:"json",
   //              data:{'id':id},
   //              type: 'post',
   //              success:function(res){

   //                  if(res.code == 200){

   //                     $('._setTimecontain').on('click','.del',function(e){

			// 			// console.dir($(this).parent());
						
			// 			$(this).parent().remove();

			// 			// "message":"\u5220\u9664\u6210\u529f!",  
			// 			console.dir(res);  

			// 		   });

   // //                  }else{

   //                      // 无数据，数据格式查看 32 行
   //                      // "code":403,                                                                                  
   //             			// "message":"\u5220\u9664\u5931\u8d25\uff0c\u8bf7\u6307\u5b9a\u5220\u9664\u6761\u4ef6!"    

   //                  }
   //              }
   //          });

            // 成功，返回数据格式：
            // {
            //     "code":200,                                                                        
            //     "message":"\u5220\u9664\u6210\u529f!",                                              
            // }

            // 失败，返回数据格式：
            // {
            //     "code":403,                                                                                  
            //     "message":"\u5220\u9664\u5931\u8d25\uff0c\u8bf7\u6307\u5b9a\u5220\u9664\u6761\u4ef6!"             
            // }











    </script>
</body>
</html>                                                                                                                                                                                                                                                                      