<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册经销商</title>
    <!-- <link href="__PUBLIC__/Admin/css/bootstrap.min.css?v=3.3.6" rel="stylesheet"> -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
    <script src="__PUBLIC__/Home/js/public.js"></script>
   <link rel="stylesheet" href="https://at.alicdn.com/t/font_527495_359ekha73vt8d7vi.css">
   <link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
    <script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/layui/layui.js"></script>
    <script src="__PUBLIC__/Home/js/jweixin-1.2.0.js"></script>
    <!-- <script src="__PUBLIC__/Home/js/wx_uploadImg.js"></script> -->
</head>
<style>
    * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
        }
    body{
        font-size: 0.7rem;
        color:#373737;
    }
    .ibox-content{
        width: 100vw;
    }
     header{
        display: flex;
        padding-top: 0.6rem;
        height: 8rem;
        background: -webkit-radial-gradient(top left , #99FCEF, #5291EE);
        flex-direction: column;
        align-items: center;
     }
    header>p {
        flex-direction:column;
        justify-content:center;
        padding: 2% 4% 3%;
        text-align: left;
        color: #5a5a5a;
        font-size: 0.72rem;
        }
    header>p>b{
       display: block;
       width: 4rem;
       height: 4rem;
       border-radius: 4rem; 
       background: #ccc;
       float: left;
       overflow: hidden;
    /*       padding-right: 0.5rem;*/
    }
    header>p>b>img{
        width: 100%;
    }
    header>span{
       line-height: 3rem;
       margin-left: 1rem;
       color: #5a5a5a;
    }
      
    form>.form-group{ 
    width: 100vw;
    padding:0.6rem 0.8rem;
    height: 2.5rem;
    clear:both;
    border-bottom:1px solid #d4d4d4!important;
    }
    form>.form-group:nth-of-type(3){
    height: 2.8rem;
    }
    form>.form-group:nth-of-type(7){
        border-bottom:none!important;
        border-top: 10px solid #d4d4d4;
        margin-top: 1rem;
    }
    form>.form-group1{
         height: 7rem;
        border-bottom: none!important;
        position: relative;
        /*background: yellow;*/
        /*opacity: 0.3;*/
        /*margin-top: 1rem;*/
        padding: 0.0rem 0.8rem;
   }
    form>div.form-group:nth-of-type(3){
        border-bottom:10px solid #d4d4d4!important;
         /*margin-bottom: 1rem;*/
    }
    form>div.form-group:nth-of-type(5){
        border:none!important;
        
    }
   /* form>div.form-group:nth-of-type(4)>label{
        display: block;
    }*/
    form>div.form-group:nth-of-type(4)>.col-md-3{
        position: relative;
    }
    form>.form-group>i{
        float: left;
        font-size: 1.2rem;
        padding-right: 0.3rem;
    }
    
    form>.form-group>label{
        /*float: left;*/
        letter-spacing: 0.12rem;
        line-height: 1.2rem;
        font-size: 0.72rem;
    }
    .col-md-3{
        display: inline-block;
        width: 55%;
        box-sizing: border-box;
    }
    form>.form-group1>label{
        line-height: 2.5rem;
        display: block;
    }
     form>.form-group>.col-md-3>input{
        height: 1.2rem;
        border:none;
        padding-left: 1vw;
        width: 100%;
     }
     /*重置样式和申请*/
      form>.form-group{
        border-bottom: none;
        width: 100vw !important;
      }
     form>.form-group>.col-sm-4{
        position: relative;
        margin-top: 1rem;
        bottom: 1rem;
     }
     form>.form-group>.col-sm-offset-2>input{
        letter-spacing: 0.1rem;
        font-size: 0.72rem;
        background: #fff;
        border-radius: 0.4rem;
        padding:0.2rem 2rem;
        border:1px solid #737373;
     }
     form>.form-group>.col-sm-offset-2>input.btn-primary{
        margin-right: 2.7rem;
     }
     form>.form-group>.col-sm-offset-2>input.btn-white{
        float: right;
    }

    .icon-gongsimingcheng{
        color: #2EB6AA;
    }
    .icon-dianhua {
        color: #23A0E8;
    }
    .icon-dizhi {
        color: #E55C1F;
    }
    .form-group>.col-md-5{
        display: inline-block;
        width: 20vw;
    }
    form>.form-group>.col-md-5>input{
        position: absolute;
        width: 4.4rem;
        height: 4.4rem;
        background: green;
        opacity: 0;
        z-index: 999;
        left: 1rem;
        top: 2.5rem;
    }
    /*.form-group>.col-md-5>i{
        position: relative;
        top: 0rem;
        left: 0.3rem;
        font-size: 3rem;
        color: #56aaf1;
        z-index: 666;
    }*/

    /*图片区域*/
    form>.form-group1>.col-md-5>i {
        position: absolute;
        top:2.5rem;
        left: 0.8rem;
        font-size: 3.8rem;
        color: #DCF8FF;
        border: 1px dashed #76DED3;
        padding: 0.2rem 0.4rem;
        border-radius: 0.6rem;
    }
    .col-md-5>.xiePic{
        visibility:hidden;
        width: 4.6rem;
        line-height: 4.6rem;
        text-align: center;
        height: 4.6rem;
        position: absolute;
        border-radius: 0.5rem;
        left: 6rem;
        top:2.5rem;
        color: #5a5a5a;
        /*border: 1px dashed #76DED3;*/
        /*overflow: hidden;*/
    }
    .col-md-5>.xiePic img{
        border-radius: .4rem;
        width: 100%;
        height: 100%;
    }
    .xiePic>i{
        position: absolute;
        top: -0.3rem;
        right: -0.3rem;
        display: block;
        width: 1rem;
        height: 1rem;
        border-radius: 0.8rem;
        background: red;
        line-height: 1rem;
        color: #fff;
        font-weight: 600;
    }
    /*申请按钮*/
    .xieBtn>input{
        margin-top:2rem;
        position: absolute;
        background: #2EB6AA;
        width: 100vw;
        border:none;
        color: #fff;
        height: 2rem;
        letter-spacing: 0.1rem;
        font-size: 0.8rem;
    }
</style>
<body>
    <div class="ibox-content">
        <header>
            <p><b><img src="{{$vendor.head}}" alt="" width="120%"></b></p>
            <p><span>{{$vendor.name}}</span></p>
        </header>
        <form action="{{:U('Home/Vendors/identity_refillings')}}" method="post" class="form-horizontal clearfix" enctype="multipart/form-data">
        <!-- <form action="" method="post" id="form" class="form-horizontal clearfix" enctype="multipart/form-data">     -->
            <div class="form-group">
                <i class="iconfont icon-gongsimingcheng"></i>
                <label class="col-sm-2 control-label" for="comName">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名</label>

                <div class="col-md-3">
                    <input id="comName" type="text" name="name" class="form-control">
                </div>
            </div> 
           <div class="form-group">
                <i class="iconfont icon-dianhua"></i>
                <label class="col-sm-2 control-label" for="comTel">移动电话</label>

                <div class="col-md-3">
                    <input id="comTel" type="text" name="phone" class="form-control">
                </div>
            </div>
             <div class="form-group">
                <i class="iconfont icon-dizhi"></i>
                <label class="col-sm-2 control-label" for="comAddr">身份证号</label>

                <div class="col-md-3">
                    <input id="comAddr" type="text" name="identity" class="form-control">
                </div>
            </div>
             <div class="form-group  form-group1">
                <label class="col-sm-2 control-label" >上传身份证正面</label>
                <div class="col-md-5">
                    <input id="comLicen" name="positive" class="form-control" type="button">
                    <input type="hidden" name="pic">
                    <i class="iconfont icon-tianjiajingdian"></i>
                    <div class="xiePic" index="0"><img src="" id="positive" style="width: 100%;"><i class="iconfont icon-cuohao"></i></div>
                </div>
            </div> 
            <div class="form-group form-group1">
                <label class="col-sm-2 control-label">上传身份证反面</label>
                <div class="col-md-5">
                    <input type="button" id="comLicen1" name="opposite" class="form-control">
                    <input type="hidden" name="pic">
                    <i class="iconfont icon-tianjiajingdian"></i>
                    <div class="xiePic" index="0"><img src="" id="opposite" style="width: 100%;"><i class="iconfont icon-cuohao" ></i></div>
                </div>
            </div>  
            <div class="form-group form-group1">
                <label class="col-sm-2 control-label">上传手持身份证</label>
                <div class="col-md-5">
                    <input type="button" id="comLicen2" name="handheld" class="form-control">
                    <input type="hidden" name="pic">
                    <i class="iconfont icon-tianjiajingdian"></i>
                    <div class="xiePic" index="0"><img src="" id="handheld" style="width: 100%;"><i class="iconfont icon-cuohao" ></i></div>
                </div>
            </div> 
            <div class="xieBtn">
                <input class="btn btn-primary" type="submit" value="申请"></input>
            </div>
        </form>
    </div>
    <script>
        //微信接口
        wx.config({
            debug: false,
            appId: '{{$info["appId"]}}',
            timestamp: '{{$info["timestamp"]}}',
            nonceStr: '{{$info["nonceStr"]}}',
            signature: '{{$info["signature"]}}',
            jsApiList: [
            // 所有要调用的 API 都要加到这个列表中
            'chooseImage',
                'uploadImage',
                'getLocalImgData',
                'downloadImage'
            ]
        });
        // 点击上传图片
        $("input[type=button]").on("click", function() {
            if($(this).siblings(".xiepic").is(":visible")) {
                layui.use("只支持一张图片!继续操作会覆盖原图片", function(index){
                    var layer = layui.layer;
                    layer.confirm(text, function(index) {
                        // 确认后执行函数并关闭窗口
                        takePicture(1, $(this));
                        layer.close(index);
                    });
                });
            }else {
                takePicture(1, $(this));
            }
        })
        var formData = new FormData($("#form")[0]);
        // 删除图片
        $(".icon-cuohao").on("click", function() {
            $(this).parent().css("visibility", "hidden").attr("index", "0").siblings("img").attr("src", "");

        })

        // 表单提交
        $("form").submit(function(e) {
            var tradeObj = {};// 要传入后台的数据对象
            var inputName = $('#comName').val();//输入用户名的值
            var inputTell = $('#comTel').val();//输入电话号码的值
            var inputIdcard = $('#comAddr').val();//输入身份证号码的值
            // 用户正则验证
            if(inputName) {
                // 验证是否合法用户名：字母或中文开头，数字字母下划线中文,2-30位
                var nameReg = /^[\u4e00-\u9fa5\w]{2,30}$/;
                if(!nameReg.test(inputName)) {
                    layuiHint("姓名以中文、字母、数字、下划线组成,2-30位");
                }else{
                    // 手机号码验证
                    if(inputTell) {
                        var tellReg = /^1[3|4|5|8][0-9]\d{4,8}$/;
                        if(!tellReg.test(inputTell)) {
                            layuiHint("电话号码格式错误");
                        }else{
                            // 身份证正则验证
                            if(inputIdcard) {
                                var idcardReg = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
                                if(!idcardReg.test(inputIdcard)) {
                                   layuiHint("身份证格式错误") ;
                                }else{
                                    // 正面身份证是否提交
                                    if($('.xiePic').eq(0).attr("index") === "1") {
                                        // 反面身份证是否提交
                                        if($('.xiePic').eq(1).attr("index") === "1"){
                                            // 手持身份证是否提交
                                            if($('.xiePic').eq(2).attr("index") === "1") {

                                                window.location.href = "{{:U('Home/Vendors/company')}}";
                                                // 验证成功后跳转

                                            }else{
                                                layuiHint("请提交手持身份证");
                                            }
                                        }else{
                                            layuiHint("请提交反面身份证");
                                        }
                                    }else{
                                        layuiHint("请提交正面身份证");
                                    }
                                }
                            }else{
                                layuiHint("身份证号码不能为空");
                            }
                        }
                    }else {
                        layuiHint("电话号码不能为空");
                    }
                }
            }else {
                layuiHint("姓名不能为空");
            }
            return false;
        })

function takePicture(nums, obj) {  
	
    wx.chooseImage({  
        count: 1,  
        needResult: 1,  
        sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有  
        sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有  
        success: function (data) {                  
            localIds = data.localIds[0];   // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片        
                              
            var num1 = nums;
            var objs = obj;
            wxuploadImage(localIds,num1, objs);
            wxgetLocalImgData(localIds,num1, objs);
        },  
        fail: function (res) {  
            console.log('失败：',JSON.stringify(res));
        }    
    });  

}
function wxuploadImage(e,num, objs) {

 wx.uploadImage({  
     localId: e, // 需要上传的图片的本地ID，由chooseImage接口获得  
     isShowProgressTips: 1, // 默认为1，显示进度提示  
     success: function (res) {   
        // alert('成功！',JSON.stringify(res));                                     
        mediaId = res.serverId;                     
        $(objs).siblings('input[name="pic"]').val(mediaId);
     },  
     fail: function (error) {  
        // alert('失败！',error);    
        picPath = '';  
        localIds = '';  
     }          
 });

}
function wxgetLocalImgData(e,num, objs){
    // ios
   if(window.__wxjs_is_wkwebview){
       wx.getLocalImgData({
           localId: e, // 图片的localID
           success: function (res) {    

                var localData = res.localData; // localData是图片的base64数据，可以用img标签显示
                localData = localData.replace('jgp', 'jpeg');//iOS 系统里面得到的数据，类型为 image/jgp,因此需要替换一下                                
                $(objs).siblings(".xiePic").children("img").attr("src", localData);
                $(objs).siblings(".xiePic").css("visibility", "visible").attr("index", "1");

           },
           fail:function(res){
                alert("显示失败");
           }
       });
   }else{ //安卓
        $(objs).siblings(".xiePic").children("img").attr("src", e);
        $(objs).siblings(".xiePic").css("visibility", "visible");
       
   }

}
    </script>
</body>
</html>

