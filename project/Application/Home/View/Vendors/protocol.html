<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>提交公司信息页面</title>
    <!-- <link href="/Public/Admin/css/bootstrap.min.css?v=3.3.6" rel="stylesheet"> -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
    <script src="__PUBLIC__/Home/js/public.js"></script>
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_527495_359ekha73vt8d7vi.css">
    <link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
    <script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
    <link href="__PUBLIC__/Admin/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
    <script src="__PUBLIC__/Admin/js/plugins/sweetalert/sweetalert.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/layui/layui.js"></script>
</head>
<style>
    * {
         margin: 0;
         padding: 0;
         box-sizing: border-box;
        }
    body{
        font-size: 0.7rem;
        color:#373737;
    }
    .ibox-content{
        width: 100vw;
    }
     header{
        display: flex;
        padding-top: 0.6rem;
        height: 8rem;
        background: -webkit-radial-gradient(top left , #99FCEF, #5291EE);
        flex-direction: column;
        align-items: center;
     }
    header>p {
        flex-direction:column;
        justify-content:center;
        padding: 2% 4% 3%;
        text-align: left;
        color: #5a5a5a;
        font-size: 0.72rem;
        }
        header>p>b{
            display: block;
            width: 4rem;
            height: 4rem;
            border-radius: 4rem; 
            background: #ccc;
            float: left;
            overflow: hidden;
        }
         header>p>b>img{
            width: 100%;
        }
         header>span{
            display: block;
            line-height: 3rem;
            margin-left: 1rem;
            color: #5a5a5a;
        }
      
        form>.form-group{
            width: 100vw;
            padding:0.6rem 0.8rem;
            height: 2.5rem;
            clear:both;
            border-bottom:1px solid #d4d4d4!important;
        }
        form>div.form-group:nth-of-type(1){
            border-bottom:6px solid #d4d4d4!important;
            padding: 0.3rem 0.5rem;
            margin-top: 0.28rem;
        }
       /* form>div.form-group:nth-of-type(1)>a{
            margin:0.3rem 0;
        }*/
        form>div.form-group:nth-of-type(1)>a>i{
            float: left;
            color: #ED9147;
            font-size: 1.2rem;
            margin-right: 0.2rem;
        }
        form>div.form-group:nth-of-type(1)>a>span{
            float: left;
            line-height: 1.35rem;
        }
        form>div.form-group:nth-of-type(1)>a{
            display:block;
            
        }
        form>div.form-group:nth-of-type(1)>i{
            float: right;
            font-size: 0.8rem;
            line-height: 1.6rem;
        }
        form>div.form-group:nth-of-type(2){
            height: 7.8rem; 
            /*border-bottom:6px solid #d4d4d4;*/
            border:none!important;

        }
        form>div.form-group:nth-of-type(3){
            border:none!important;
            
        }
        form>div.form-group:nth-of-type(2)>label{
            display: block;
        }
        form>div.form-group:nth-of-type(2)>.col-md-3{
            position: relative;

        }
        /*添加*/
         form>.form-group>.col-md-3>i{
          position: absolute;
          top: 2.1rem;
          left: 0rem;
          font-size: 3.8rem;
          color: #DCF8FF;
          border: 1px dashed #76DED3;
          padding: 0.198rem 0.4rem;
          border-radius: 0.6rem;
         }
      
        form>div.form-group:nth-of-type(2)>.col-md-3>input{
            position: relative;
            left: -4.8rem;
            top: 2.3rem;
            height: 4rem;
            width: 4rem;
            opacity: 0;
            z-index: 999;
            /*background: red;*/
        }
        form>div.form-group:nth-of-type(2)>.col-md-3>.xiePic{
            visibility: hidden;
            width: 4.6rem;
            line-height: 4.6rem;
            text-align: center;
            height: 4.6rem;
            position: absolute;
            border-radius: 0.5rem;
            left: 5rem;
            top: 2.15rem;
            color: #5a5a5a;
        }
        .xiePic>i{
            position: absolute;
            top: -0.3rem;
            right: -0.3rem;
            display: block;
            width: 1rem;
            height: 1rem;
            border-radius: 0.8rem;
            background: red;
            line-height: 1rem;
            color: #fff;
            font-weight: 600;
        }
        .xiePic>img{
            border-radius: .4rem;
            width: 100%;
            height: 100%;
        }

        form>.form-group>i{
            float: left;
            font-size: 1.2rem;
        }
     
        form>.form-group>label{
            float: left;
            letter-spacing: 0.12rem;
            line-height: 1.2rem;
            font-size: 0.72rem;
        }
         form>.form-group>.col-md-3>input{
            width: 56vw;
            height: 1.2rem;
            border:none;
         }
         .icon-gongsimingcheng{
            color: #2EB6AA;
        }
        .icon-shouji {
            color: #23A0E8;
        }
        .icon-dizhi {
            color: #E55C1F;
        }
          /*申请按钮*/
          .xieBtn>input{
            position: absolute;
            bottom: 0;
            background: #2EB6AA;
            width: 100vw;
            border:none;
            color: #fff;
            height: 2rem;
            letter-spacing: 0.1rem;
            font-size: 0.8rem;
          }

            /*付款页面*/
        .paystyle{
            position:fixed;
            top:0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
        }
        .paystyleTop{
            width: 100vw;
            height: 10vh;
            background: #000;
            opacity: 0.3;
        }
        .payContain{
            position: absolute;
            bottom: 0;
            height: 90vh;
            width: 100vw;
            /*opacity: 0.5;*/
            z-index: 999;
            background: #FFF;
        }
        .payContain>.paytop{
            padding:0.5rem;
            border-bottom: 1px solid #E5E5E5;
        }
        .paytop>.paytopLeft>i{
            float: left;
            padding: 0.6rem 0;
            margin-right: 4rem;
            font-size: 1.5rem;
        }
        /*支付图标的颜色*/
        .icon-jinbi{
            color:#FEDA02;
        }
        .icon-yingbi{
            color:#97C3C0;
            
        }
        .icon-z-weixin{
            color:#149E23;
            
        }
        .icon-zhifubao{
            color:#22A8FF;
            
        }
        .icon-yinhang-yinlian-{
            color:#6BB5BB;
            
        }
        .paytop>.paytopRight{
            float: left;
            text-align: center;
        }
        .icon-kuang1{
            color:#ccc;
        }
        .paytop>.paytopRight>h3{
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0 0 0.5rem;
        }
        .paytop>.paytopRight>h3>span{
            color: orange;
            font-size: 0.65rem;
            padding:0.3rem;
        }
        .paytop>.paytopRight>p{
            font-size: 0.9rem;
            font-weight: 600;
        }
        .paymidd>h3{
            padding:0.8rem;
        }
        .paymidd>ul>li{
            padding:0.6rem 0.5rem;
            border-bottom: 1px  solid #E5E5E5;
        }
        .paymidd>ul>li>i{
            padding-right:0.4rem; 
            font-size: 1.2rem;
        }
        .paymidd>ul>li>span{
            float: right;
            font-size: 1rem;
        }
        /*底部按钮*/
        .payBott{
            width: 86vw;
            margin:8.5vh 7vw 0;
        }
        .payBott>input{
            border:none;
            padding:1vh  0;
            width: 86vw;
            background: #2EB6AA;
            border-radius:0.2rem;
            color: #FFF;
        }
        /*模态框样式*/
      .modelAll{width:100vw;height:100%;font-family: "mircoft yahei";font-size:14px;font-size: 0.7rem;line-height: 1; display: none;overflow: hidden;}
      .modal{position:absolute;left:0;right:0;z-index: -1;}
      .fade{opacity:0;top:-10%;display:block;-webkit-transition:top 0.3s linear;-o-transition:top 0.3s linear;transition:top 0.3s linear;}
      .fade.in{opacity:1;top:10%;}
      .modal-body{width:80%;margin:5rem auto;background-color: #fff;border-radius:0.5rem;}
      .modal-title{position:relative;height:40px;background-color: #D31145;line-height: 40px;border-bottom:1px solid #ccc;}
      .modal-backup{position:fixed;top:0;left:0;right:0;width:100%;height:100%;background-color: rgba(0, 0, 0, 0.5);z-index: 1000;display:none;}
      .modal-content>p{
        padding:0.8rem;
        text-align: center;
        border-bottom:1px solid #E5E5E5;
      }
      .modal-content>p>a{
        color:#64A0F2;
      }
      .modal-content>p>input{
        border:none;
        background: none;
        color:#64A0F2;
      }
      .modal-content>p:nth-child(4){
        border:none;
      }
      .icon-xuanze{
        color:#56AAF1 !important;
      }
       
</style>
<body>
    <div class="ibox-content">
        <header>
            <p><b><img src="{{$vendor.head}}" alt="" width="120%"></b></p>
            <p><span>{{$vendor.name}}</span></p>
        </header>
        <form action="javascript:false;" method="post" id="pic" class="form-horizontal clearfix" enctype="multipart/form-data">    
            <div class="form-group">
               <a href="__PUBLIC__/Vendors/hetong.docx" download="hetong.docx"> <i class="iconfont icon-yonghuxieyi"></i><span>合同样本</span></a> 
               <i class="iconfont icon-dayuhao-copy-copy"></i>
            </div> 
            <div class="form-group">
                <label class="col-sm-2 control-label" for="comLicen">上传协议文件</label>
                <div class="col-md-3">
                    <input type="button" id="comLicen" name="protocol" class="form-control">
                    <i class="iconfont icon-tianjiajingdian"></i>
                    <div class="xiePic" index="0"><img src="" id="protocol" style="width: 100%;"><i class="iconfont icon-cuohao" onclick="removePic(this)"></i></div>
                </div>
            </div> 
            <div class="xieBtn">
                <input class="btn btn-primary" type="submit" value="申请"></input>
            </div>
        </form>
       <!-- 付款页面 -->
        <div class="paystyle">
            <div class="paystyleTop"></div>
            <div class="payContain">
                <div class="paytop clearfix">
                    <div class="paytopLeft"><i class="iconfont icon-cuohao"></i></div>
                    <div class="paytopRight">
                        <h3>付款<span>(加盟费)</span></h3>
                        <p>￥3620.00</p>
                    </div>  
                </div>
                <div class="paymidd">
                    <h3>选择支付方式</h3>
                    <ul class="clearfix">
                       <!--  <li><i class="iconfont icon-jinbi"></i>金币<span class="iconfont icon-xuanze"></span></li>
                        <li><i class="iconfont icon-yingbi"></i>银币<span class="iconfont icon-kuang1"></span></li> -->
                        <li><i class="iconfont icon-z-weixin"></i>微信支付<span class="iconfont icon-kuang1"></span></li>
                        <li><i class="iconfont icon-zhifubao"></i>支付宝支付<span class="iconfont icon-kuang1"></span></li>
                        <li><i class="iconfont icon-yinhang-yinlian-"></i>银联<span class="iconfont icon-kuang1"></span></li>
                    </ul>
                </div>
                <div class="payBott start">
                    <input class=" start" type="submit" value="立即支付">
                </div>
            </div>
        </div>
        <!-- 模态框的内容 -->
        <div class="modal-backup">
            <div class="modelAll">
                <!-- <a class="start" href="javascript:;">点击</a> -->
                <div class="modal fade">
                    <div class="modal-body">
                        <div class="modal-content">
                            <p>您咱没有绑定银行卡</p>
                            <p class="close"><a href="#">去绑定</a></p>
                            <p class="close"><a href="#">其他支付方式</a></p>
                            <p><input class="close" type="submit" value="取消"></p>
                        </div>
                    </div>
                </div>
            
            </div>
        </div>
    </div>
    <script src="__PUBLIC__/Home/js/jweixin-1.2.0.js"></script>
    <script>
        //微信接口
        wx.config({
            debug: false,
            appId: '{{$info["appId"]}}',
            timestamp: '{{$info["timestamp"]}}',
            nonceStr: '{{$info["nonceStr"]}}',
            signature: '{{$info["signature"]}}',
            jsApiList: [
            // 所有要调用的 API 都要加到这个列表中
            'chooseImage',
                'uploadImage',
                'getLocalImgData',
                'downloadImage'
            ]
        });
        //支付方式   
        $('.xieBtn').click(function(){

            if($(".xiePic").attr("index") === "1") {
                // 获取表单数据
                var formData = new FormData(document.getElementById("pic"));
                $.ajax({
                    url: "{{:U('Home/Vendors/protocol')}}",
                    type: 'post',
                    data: formData,
                    async: false,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (res) {
                        console.log(res)
                        if(res.code == 200){
                             // 跳转到微信支付页面 
                             window.location.href="{{:U('Home/Vendors/index')}}";
                        } else {
                            
                            swal('提交失败',res.msg, "error");
                        }
                    },
                    error: function (res) {
                        swal('提交失败',res.msg, "error");
                    }
                });
            }else{
                layuiHint("协议文件必须上传")
            }
        }) 
        // 点击上传图片
        $("input[type=button]").on("click", function() {
            if($(this).siblings(".xiepic").is(":visible")) {
                layui.use("只支持一张图片!继续操作会覆盖原图片", function(index){
                    var layer = layui.layer;
                    layer.confirm(text, function(index) {
                        // 确认后执行函数并关闭窗口
                        takePicture(1, $(this));
                        layer.close(index);
                    });
                });
            }else {
                takePicture(1, $(this));
            }
        })

        function takePicture(nums, obj) {  
            wx.chooseImage({  
                count: 1,  //最多可以选择的图片张数
                needResult: 1,  
                sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有  
                sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有  
                success: function (data) {                  
                    localIds = data.localIds[0];   // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片        
                                    
                    var num1 = nums;
                    var objs = obj;
                    wxuploadImage(localIds,num1, objs);
                    wxgetLocalImgData(localIds,num1, objs);
                },  
                fail: function (res) {  
                    console.log('失败：',JSON.stringify(res));
                }    
            });  

        }
        function wxuploadImage(e,num, objs) {

            wx.uploadImage({  
                localId: e, // 需要上传的图片的本地ID，由chooseImage接口获得  
                isShowProgressTips: 1, // 默认为1，显示进度提示  
                success: function (res) {   
                    // alert('成功！',JSON.stringify(res));                                     
                    mediaId = res.serverId;                     
                    $(objs).siblings('input[name="pic"]').val(mediaId);
                },  
                fail: function (error) {  
                    // alert('失败！',error);    
                    picPath = '';  
                    localIds = '';  
                }          
            });

        }

        function wxgetLocalImgData(e,num, objs){
            // ios
            if(window.__wxjs_is_wkwebview){
                wx.getLocalImgData({
                    localId: e, // 图片的localID
                    success: function (res) {                    
                            var localData = res.localData; // localData是图片的base64数据，可以用img标签显示
                            localData = localData.replace('jgp', 'jpeg');//iOS 系统里面得到的数据，类型为 image/jgp,因此需要替换一下                                
                            $(objs).siblings(".xiePic").children("img").attr("src", localData);
                            $(objs).siblings(".xiePic").css("visibility", "visible").attr("index", "1");

                    },
                    fail:function(res){
                            alert("显示失败");
                    }
                });
            }else{ //安卓
                    $(objs).siblings(".xiePic").children("img").attr("src", e);
                    $(objs).siblings(".xiePic").css("visibility", "visible").attr("index", "1");
                
            }

        }
        var formData = new FormData($("#form")[0]);
        // 点击叉叉隐藏div
        function removePic(removeObj) {
            removeObj.previousSibling.src = "";//将图片路径删除
            removeObj.parentNode.style.visibility = "hidden";//隐藏div
            removeObj.parentNode.setAttribute("index", "0");//设置index为0
        }

    </script>
</body>
</html>

 
