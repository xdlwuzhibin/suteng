<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>加盟合伙人</title>
	<!-- <link href="/Public/Admin/css/bootstrap.min.css?v=3.3.6" rel="stylesheet"> -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <link rel="stylesheet" href="__PUBLIC__/Home/css/resetstyle.css">
    <script src="__PUBLIC__/Home/js/public.js"></script>
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_527495_359ekha73vt8d7vi.css">
    <link rel="stylesheet" href="__PUBLIC__/Home/fonts/iconfont.css">
    <script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/Admin/layui/layui.js"></script>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    body{
        font-size: 0.7rem;
        color:#373737;
    }
    .ibox-content{
        width: 100vw;
    }
    header{
        display: flex;
        padding-top: 0.6rem;
        height: 8rem;
        background: -webkit-radial-gradient(top left , #99FCEF, #5291EE);
        flex-direction: column;
        align-items: center;
    }
    
    header>p {
        flex-direction:column;
        justify-content:center;
        padding: 2% 4% 3%;
        text-align: left;
        color: #5a5a5a;
        font-size: 0.72rem;
    }
    header>p>b{
        display: block;
        width: 4rem;
        height: 4rem;
        border-radius: 4rem; 
        background: #ccc;
        float: left;
        overflow: hidden;
    }
    header>p>b>img{
        width: 100%;
    }
    header>span{
        display: block;
        line-height: 3rem;
        margin-left: 1rem;
        color: #5a5a5a;
    }
    form {
        padding-bottom: 1rem;
    }
    form>.form-group{
        width: 100vw;
        padding:0.6rem 0.8rem;
        height: 2.5rem;
        clear:both;
        border-bottom:1px solid #d4d4d4!important;
    }
    form>div.form-group:nth-of-type(3){
        border-bottom:6px solid #d4d4d4!important;
    }
    form>div.form-group:nth-of-type(4){
        height: 7.8rem; 
        /*border-bottom:6px solid #d4d4d4;*/
        border:none!important;
        
    }
    form>div.form-group:nth-of-type(5){
        border:none!important;
        
    }
    form>div.form-group:nth-of-type(4)>label{
        display: block;
    }
    form>div.form-group:nth-of-type(4)>.col-md-3{
        position: relative;
        
    }
    form>div.form-group:nth-of-type(4)>.col-md-3>input{
        position: relative;
        left: -3.3rem;
        top: 2.3rem;
        height: 4rem;
        width: 4.5rem;
        opacity: .2;
        z-index: 999;
        background: red;
    }
    form>.form-group>i{
        float: left;
        font-size: 1.2rem;
        padding-right:0.4rem;
    }
    
    form>.form-group>label{
        float: left;
        letter-spacing: 0.12rem;
        line-height: 1.2rem;
        font-size: 0.72rem;
    }
    form>.form-group>.col-md-3>input{
        width: 52%;
        height: 1.2rem;
        border:none;
        box-sizing: border-box;
    }
    form>div.form-group:nth-of-type(4)>.col-md-3{
        position: relative;
        
    }
    /*添加*/
    form>.form-group>.col-md-3>i{
        position: absolute;
        top: 2.1rem;
        left: 0rem;
        font-size: 3.8rem;
        color: #DCF8FF;
        border: 1px dashed #76DED3;
        padding: 0.2rem 0.4rem;
        border-radius: 0.6rem;
    }
    
    form>div.form-group:nth-of-type(4)>.col-md-3>input{
        position: relative;
        left: -3rem;
        top: 2.3rem;
        height: 4rem;
        width: 4rem;
        opacity: 0;
        z-index: 999;
        /*background: red;*/
    }
    form>div.form-group:nth-of-type(4)>.col-md-3>.xiePic{
        visibility: hidden;
        width: 4.6rem;
        line-height: 4.6rem;
        text-align: center;
        height: 4.6rem;
        position: absolute;
        border-radius: 0.5rem;
        left: 5rem;
        top: 2.15rem;
        color: #5a5a5a;
    }
    .xiePic>i{
        position: absolute;
        top: -0.3rem;
        right: -0.3rem;
        display: block;
        width: 1rem;
        height: 1rem;
        border-radius: 0.8rem;
        background: red;
        line-height: 1rem;
        color: #fff;
        font-weight: 600;
    }
    .xiePic>img{
        border-radius: .4rem;
        width: 100%;
        height: 100%;
    }
    /*申请按钮*/
    .xieBtn{
        /* position: fixed;
        bottom: 0; */
        margin-top: 1.6rem;
    }
    .xieBtn>input{
        background: #2EB6AA;
        width: 90vw;
        margin: 0 auto;
        display: block;
        border:none;
        color: #fff;
        height: 2rem;
        letter-spacing: 0.1rem;
        font-size: 0.8rem;
    }
    
    
    .icon-gongsimingcheng1{
        color: #48AF98;
    }
    .icon-dianhua {
        color: #23A0E8;
    }
    .icon-dizhi {
        color: #E55C1F;
    }
</style>
<body>
    <div class="ibox-content">
        <header>
            <p><b><img src="{{$vendor.head}}" alt="" width="120%"></b></p>
            <p><span>{{$vendor.name}}</span></p>
        </header>
        <!-- <form action="{{:U('Home/Vendors/company')}}" method="post" class="form-horizontal clearfix" enctype="multipart/form-data">    -->
            <form action="" method="post" enctype="multipart/form-data" class="form-horizontal clearfix"> 
                <div class="form-group">
                    <i class="iconfont icon-gongsimingcheng1"></i>
                    <label class="col-sm-2 control-label" for="comName">公司名称</label>
                    
                    <div class="col-md-3">
                        <input id="comName" type="text" name="company" class="form-control">
                    </div>
                </div> 
                <div class="form-group">
                    <i class="iconfont icon-dianhua"></i>
                    <label class="col-sm-2 control-label" for="comTel">固定电话</label>
                    
                    <div class="col-md-3">
                        <input id="comTel" type="text" name="telephone" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <i class="iconfont icon-dizhi"></i>
                    <label class="col-sm-2 control-label" for="comAddr">公司地址</label>
                    
                    <div class="col-md-3">
                        <input id="comAddr" type="text" name="address" class="form-control">
                    </div> 
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label" for="comLicen">营业执照</label>
                    <div class="col-md-3">
                        <input type="button" id="comLicen" name="licence" class="form-control">
                        <i class="iconfont icon-tianjiajingdian"></i>
                        <div class="xiePic" index="0">
                            <img src="" id="licence"><i class="iconfont icon-cuohao" onclick="removePic(this)"></i></div>
                        </div>
                    </div> 
                    <div class="xieBtn">
                        <input class="btn btn-primary" type="submit" value="下一步"></input>
                    </div>
                </form>
            </div>
            <script>
                //微信接口
                wx.config({
                    debug: false,
                    appId: '{{$info["appId"]}}',
                    timestamp: '{{$info["timestamp"]}}',
                    nonceStr: '{{$info["nonceStr"]}}',
                    signature: '{{$info["signature"]}}',
                    jsApiList: [
                    // 所有要调用的 API 都要加到这个列表中
                    'chooseImage',
                        'uploadImage',
                        'getLocalImgData',
                        'downloadImage'
                    ]
                });
                // 点击上传图片
                $("input[type=button]").on("click", function() {
                    if($(this).siblings(".xiepic").is(":visible")) {
                        layui.use("只支持一张图片!继续操作会覆盖原图片", function(index){
                            var layer = layui.layer;
                            layer.confirm(text, function(index) {
                                // 确认后执行函数并关闭窗口
                                takePicture(1, $(this));
                                layer.close(index);
                            });
                        });
                    }else {
                        takePicture(1, $(this));
                    }
                })
                
                function takePicture(nums, obj) {  
                    wx.chooseImage({  
                        count: 1,  //最多可以选择的图片张数
                        needResult: 1,  
                        sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有  
                        sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有  
                        success: function (data) {                  
                            localIds = data.localIds[0];   // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片        
                                            
                            var num1 = nums;
                            var objs = obj;
                            wxuploadImage(localIds,num1, objs);
                            wxgetLocalImgData(localIds,num1, objs);
                        },  
                        fail: function (res) {  
                            console.log('失败：',JSON.stringify(res));
                        }    
                    });  

                }
                function wxuploadImage(e,num, objs) {

                    wx.uploadImage({  
                        localId: e, // 需要上传的图片的本地ID，由chooseImage接口获得  
                        isShowProgressTips: 1, // 默认为1，显示进度提示  
                        success: function (res) {   
                            // alert('成功！',JSON.stringify(res));                                     
                            mediaId = res.serverId;                     
                            $(objs).siblings('input[name="pic"]').val(mediaId);
                        },  
                        fail: function (error) {  
                            // alert('失败！',error);    
                            picPath = '';  
                            localIds = '';  
                        }          
                    });

                }

                function wxgetLocalImgData(e,num, objs){
                    if(window.__wxjs_is_wkwebview){
                        wx.getLocalImgData({
                            localId: e, // 图片的localID
                            success: function (res) {                    
                                    var localData = res.localData; // localData是图片的base64数据，可以用img标签显示
                                    localData = localData.replace('jgp', 'jpeg');//iOS 系统里面得到的数据，类型为 image/jgp,因此需要替换一下                                
                                    $(objs).siblings(".xiePic").children("img").attr("src", localData).end().css("visibility", "visible");

                            },
                            fail:function(res){
                                    alert("显示失败");
                            }
                        });
                    }else{
                            $(objs).siblings(".xiePic").children("img").attr("src", e).end().css("visibility", "visible");
                        
                    }

                }
                // 点击叉叉隐藏div
                function removePic(removeObj) {
                    removeObj.previousSibling.src = "";//将图片路径删除
                    removeObj.parentNode.style.visibility = "hidden";//隐藏div
                    removeObj.parentNode.setAttribute("index", "0");//设置index为0
                }
                // 提交验证
                $('form').submit(function(e) {
                    var comNameVal = $('#comName').val();//输入公司名称
                    var comTellVal = $("#comTel").val();//输入公司固定电话
                    var comAddrVal = $("#comAddr").val();//公司地址
                    // 验证是否合法公司名称：字母或中文开头，数字字母下划线中文,2-30位
                    var comNameReg = /^[\u4e00-\u9fa5\w]{2,30}$/;
                    if(comNameVal) {
                        if(comNameReg.test(comNameVal)) {
                            // 座机号码验证
                            if(comTellVal) {
                                var comTellReg = /^((0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$/;//固定电话号码
                                var comTellRegs = /^1[3|4|5|8][0-9]\d{4,8}$/;//手机号码
                                if(comTellReg.test(comTellVal) || comTellRegs.test(comTellVal)) {
                                    // 公司地址验证
                                    if(comAddrVal) {
                                        var comAddrReg = /^[\w\-\u4e00-\u9fa5]{6,255}$/u;
                                        if(comAddrReg.test(comAddrVal)) {
                                            // 上传营业执照图片
                                            if($(".xiePic").attr("index") === "1") {
                                                // 验证成功后跳转
                                                window.location.href = "{{:U('Home/Vendors/protocol')}}";
                                            }else{
                                                layuiHint("营业执照图片必须上传"); 
                                            }
                                        }else{
                                            layuiHint("请输入完整的公司地址");
                                        }
                                    }else{
                                        layuiHint("请输入公司地址");
                                    }
                                }else{
                                    layuiHint("坐机号码或手机号码格式不正确");
                                }
                            }else{
                                layuiHint("请输入坐机号码");
                            }
                        }else{
                            layuiHint("公司名称格式不正确，请重新输入");
                        }
                    }else{
                        layuiHint("请输入公司名称");
                    }
                    
                    return false;
                })
            </script>
        </body>
        </html>
        
        
        