<extend name="Public/base" />

<block name="content">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>服务站管理 <small>第三方机构</small></h5>
                        <div class="ibox-tools">
                            <a href="javascript:;" class="company_add close-link">
                                <i class="fa fa-user-plus"></i>
                                添加机构
                            </a>
                        </div>
                    </div>
                <!--<form method="get" action="" class="form-inline" id='searchdiv'>-->
                    <!--<div class="form-group">-->
                        <!--<label for="where_area">地区过滤</label>-->
                        <!--<select name="province_id" class="form-control"  id="where_area">-->
                            <!--<option value="">&#45;&#45;请选择&#45;&#45;</option>-->
                            <!--<volist name="area" id="vl">-->
                                <!--<option value="{{$vl.id}}">{{$vl.areaname}}</option>-->
                            <!--</volist>-->
                        <!--</select>-->
                        <!--<select name="city_id" class="form-control "  style="min-width: 120px;">-->
                        <!--</select>-->
                        <!--<select name="district_id" class="form-control "  style="min-width: 120px;">-->
                        <!--</select>-->
                    <!--</div>-->
                    <!--<div class="form-group " >-->
                        <!--<select name="key" class="form-control where_key" >-->
                            <!--<option class="where_key_name" value="name">服务站名称</option>-->
                            <!--<option class="where_key_user" value="user">分配用户名</option>-->
                        <!--</select>-->
                        <!--<input type="text" name="keywords" placeholder="输入搜索关键字"  value="{{$where['keywords']}}"-->
                               <!--class="input form-control where_key_box where_key_box_name where_key_box_user"-->
                               <!--style="width:40%">-->
                        <!--<select name="status" class="form-control where_status" name="account" style="width:30%;">-->
                            <!--<option  class="where_status_"  value="">&#45;&#45; 状态 &#45;&#45;</option>-->
                            <!--<option  class="where_status_0" value="0">未开通</option>-->
                            <!--<option  class="where_status_1" value="1">已开通</option>-->
                            <!--<option  class="where_status_2" value="2">被代管</option>-->
                            <!--<option  class="where_status_3" value="3">第三方代管</option>-->
                            <!--<option  class="where_status_4" value="4">被关闭</option>-->
                        <!--</select>-->
                        <!--&lt;!&ndash;状态{0:未开通 1:已开通 2:被代管(服务站代管) 3:被代管(第三方代管) 4:被关闭 }&ndash;&gt;-->
                    <!--</div>-->
                    <!--<button type="submit" class="btn btn btn-primary submitbtn" name="sou">搜索</button>-->


                <!--</form>-->
                    <div class="ibox-content">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>服务站名称</th>
                                    <th>服务站图片</th>
                                    <th>地址</th>
                                    <th>联系人</th>
                                    <th>联系方式</th>
                                    <th>客服电话</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <empty name="data">
                                    <tr><td><h3>暂无数据</h3></td></tr>
                                <else />
                                    <volist name="data" id="val">
                                        <tr data-id="{{$val.id}}">
                                            <td>{{$i}}</td>
                                            <td>{{$val.company}}</td>
                                            <td><img src="/Public/upload{{$val.pic}}" height="50px"></td>
                                            <td>{{$val.province}}-{{$val.city}}-{{$val.district}}<br>{{$val.address}}</td>
                                            <td>{{$val.name}}</td>
                                            <td>{{$val.phone}}</td>
                                            <td>{{$val.telephone}}</td>

                                            <switch name="val.status">
                                                <case value="0"><td>禁用</td></case>
                                                <case value="1"><td>启用</td></case>
                                                <default />
                                                <td>禁用</td>
                                            </switch>

                                            <td>
                                        </tr>
                                    </volist>
                                </empty>
                            </tbody>
                        </table>
                        <div>
                            {{$page}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal inmodal" id="st-add" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated bounceInRight">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        第三方服务机构添加
                    </h4>
                </div>
                <div class="modal-body">
                    <div>下列表表单中，带 * 项表示必填项</div>
                    <form id="formdata" method="post" enctype="multipart/form-data">
                        <table class="table table-striped table-bordered table-hover table-condensed">
                            <tr>
                                <th>服务站名称：<span style="color: red;">*</span></th>
                                <td>
                                    <input class="input-medium form-control" placeholder="请输入服务站名称..." type="text" name="company">
                                </td>
                            </tr>
                            <tr>
                                <th width="25%">服务站地址：<span style="color: red;">*</span></th>
                                <td class="form-inline">
                                    <select class="form-control" style="width: 32%;" name="province_id">
                                        <option value="--">--请选择--</option>
                                        <volist name="area" id="vl">
                                            <option value="{{$vl.id}}">{{$vl.areaname}}</option>
                                        </volist>
                                    </select>
                                    <input type="hidden" name="province">
                                    <input type="hidden" name="city">
                                    <input type="hidden" name="district">
                                    <select class="form-control" style="width: 32%;" name="city_id">
                                        <option value="--">--请选择--</option>
                                    </select>
                                    <select class="form-control" style="width: 32%;" name="district_id">
                                        <option value="--">--请选择--</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>详细地址：<span style="color: red;">*</span></th>
                                <td><input class="input-medium form-control" type="text" name="address" value="" placeholder="请输入详细地址(不包含省市区)..."></td>
                            </tr>
                            <tr>
                                <th>服务站图片：<span style="color: red;">*</span></th>
                                <td>
                                    <input class="input-medium form-control" type="file" name="pic" >
                                </td>
                            </tr>
                            <tr>
                                <th>联系人：<span style="color: red;">*</span></th>
                                <td>
                                    <input class="input-medium form-control" type="text" name="name" placeholder="请输入服务站负责人...">
                                </td>
                            </tr>
                            <tr>
                                <th>联系人电话：<span style="color: red;">*</span></th>
                                <td>
                                    <input class="input-medium form-control" type="text" name="phone" placeholder="请输入服务站负责人电话...">
                                </td>
                            </tr>
                            <tr>
                                <th>客服电话：<span style="color: red;">*</span></th>
                                <td>
                                    <input class="input-medium form-control" type="text" name="telephone" placeholder="请输入服务站客户服务电话...">
                                </td>
                            </tr>
                            <tr>
                                <th>
                                </th>
                                <td>
                                    <input class="btn btn-success st-add" type="button" onclick="addService()" value="确认">
                                </td>
                            </tr>
                        </table>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script src="__PUBLIC__/Home/js/jquery-1.8.3.min.js"></script>
    <script>
        $(".company_add").click(function () {
            $('#st-add').modal('show');
        });
        $("select[name='province_id']").change(function(){
            var _html = '<option value="">--请选择--</option>';
            $("select[name='city_id']").html(_html);
            $("input[name='province']").val($(this).find(':selected').html());
            getArea($(this).val(),function (res) {
                if(res.status == 200){
                    $.each(res.data,function (i,val) {
                        _html += '<option value="'+val.id+'">'+val.areaname+'</option>';
                    })
                    $("select[name='city_id']").html(_html);
                }else{
                    parent.layer.msg(res.msg);
                }
            });
        });
        $("select[name='city_id']").change(function(){
            var _html = '<option value="">--请选择--</option>';
            $("select[name='district_id']").html(_html);
            $("input[name='city']").val($(this).find(':selected').html());

            getArea($(this).val(),function (res) {
                if(res.status == 200){
                    $.each(res.data,function (i,val) {
                        _html += '<option value="'+val.id+'">'+val.areaname+'</option>';

                    })
                    $("select[name='district_id']").html(_html);
                }else{
                    parent.layer.msg(res.msg);
                }
            });
        });
        $("select[name='district_id']").change(function(){
            $("input[name='district']").val($(this).find(':selected').html());
        });
        function getArea(parentid=0,Callback=false) {
            if(parentid=='')return ;
            $.ajax({
                url:"{{:U('Admin/Area/getNextArea')}}",
                data:{parentid:parentid},
                dataType:"json",
                type: 'post',
                success:function(res){
                    if(Callback){
                        Callback(res);
                    }
                },
                error: function(res) {
                    parent.layer.msg(res.msg);
                }
            });
        }
        // 添加功能执行
        function addService()
        {
            var data = document.getElementById('formdata');
            var fd = new FormData(data)
                $.ajax({
                    url:"{{:U('admin/Service/othrtAdd')}}",
                    type:'post',
                    dataType:'json',
                    cache: false,
                    contentType: false,
                    processData: false,
                    data:fd,
                    success:function(res){
                        if(res.status == 200){
                            location.reload();
                            parent.layer.msg(res.msg);
                        } else {
                            parent.layer.close;
                            parent.layer.msg(res.msg);
                        }
                    }
                });

        }

    </script>
</block>
